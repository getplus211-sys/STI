<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рк╡рк░рлНркдркорк╛рки рккрлНрк░рк╡рк╛рк╣рлЛ - KLS Quiz System</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:linear-gradient(135deg,#fee2e2,#fecaca);min-height:100vh;padding-top:130px;padding-bottom:70px}
.header{position:fixed;top:0;left:0;right:0;z-index:1000;background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 4px 20px rgba(239,68,68,0.3)}
.header-top{padding:12px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.2)}
.brand{flex:1}
.brand-name{font-size:18px;font-weight:bold;color:#fff;line-height:1.2}
.brand-subtitle{font-size:10px;color:rgba(255,255,255,0.9)}
.header-right{display:flex;align-items:center;gap:8px}
.user-name{font-size:12px;font-weight:bold;color:#fff}
.chapters-header{overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding:12px 16px;background:linear-gradient(135deg,#f87171,#ef4444);-webkit-overflow-scrolling:touch}
.chapters-header::-webkit-scrollbar{height:4px}
.chapters-header::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.5);border-radius:4px}
.chapter-tab{display:inline-block;padding:8px 16px;margin-right:8px;background:rgba(255,255,255,0.3);border-radius:20px;font-size:13px;font-weight:600;color:#7f1d1d;cursor:pointer;transition:all 0.2s;border:2px solid transparent}
.chapter-tab:hover{background:rgba(255,255,255,0.5)}
.chapter-tab.active{background:#fff;color:#b91c1c;border-color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.container{padding:0 16px;max-width:600px;margin:0 auto}
.chapter-title{background:#fff;padding:16px;margin:16px 16px 0 16px;border-radius:12px;box-shadow:0 4px 15px rgba(239,68,68,0.2);border:2px solid #fca5a5}
.chapter-title h2{font-size:18px;color:#b91c1c;font-weight:600;line-height:1.4}
.quiz-list{padding:16px}
.quiz-item{background:#fff;padding:16px;margin-bottom:12px;border-radius:12px;box-shadow:0 4px 15px rgba(239,68,68,0.15);cursor:pointer;transition:all 0.2s;border:2px solid #fecaca}
.quiz-item:hover{box-shadow:0 6px 20px rgba(239,68,68,0.3);transform:translateY(-4px);border-color:#fca5a5}
.quiz-item:active{transform:translateY(0)}
.quiz-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.quiz-name{font-size:16px;font-weight:600;color:#7f1d1d}
.quiz-badge{background:#22c55e;color:#fff;font-size:11px;padding:4px 10px;border-radius:12px;font-weight:600}
.quiz-badge.medium{background:#f59e0b}
.quiz-badge.hard{background:#ef4444}
.quiz-info{display:flex;gap:16px;margin-top:8px}
.quiz-info-item{display:flex;align-items:center;gap:6px;font-size:13px;color:#991b1b}
.loading{text-align:center;padding:60px 20px;color:#991b1b}
.spinner{font-size:48px;margin:0 auto 16px;animation:spin 2s linear infinite;display:inline-block}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.loading h3{margin-top:16px;font-size:16px;font-weight:500}
.footer{position:fixed;bottom:0;left:0;right:0;z-index:1000;background:#fff;padding:12px 16px;box-shadow:0 -4px 15px rgba(0,0,0,0.1);display:flex;justify-content:space-around;align-items:center}
.footer-btn{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:24px;color:#6b7280;cursor:pointer;transition:all 0.2s}
.footer-btn.active{color:#ef4444}
.footer-btn:hover{transform:translateY(-2px)}
.footer-label{font-size:9px;font-weight:600}
</style>
</head>
<body>
<header class="header">
  <div class="header-top">
    <div class="brand">
      <div class="brand-name">ЁЯУ░ рк╡рк░рлНркдркорк╛рки рккрлНрк░рк╡рк╛рк╣рлЛ</div>
      <div class="brand-subtitle">KAPiLa Learning</div>
    </div>
    <div class="header-right">
      <span id="userNameDisplay" class="user-name" style="display:none"></span>
    </div>
  </div>
  <div class="chapters-header" id="chaptersHeader">
    <div class="loading" style="padding:12px 0">
      <span class="spinner" style="font-size:20px;margin:0">тП│</span>
    </div>
  </div>
</header>
<div class="container">
  <div class="chapter-title" id="chapterTitle" style="display:none"><h2></h2></div>
  <div class="quiz-list" id="quizList">
    <div class="loading"><div class="spinner">тП│</div><h3>рккрлНрк░ркХрк░ркг рккрк╕ркВркж ркХрк░рлЛ</h3></div>
  </div>
</div>
<footer class="footer">
  <button class="footer-btn active" onclick="window.location.href='index-kapila.html'"><span>ЁЯПа</span><span class="footer-label">Home</span></button>
  <button class="footer-btn" onclick="window.location.href='overall-performance.html'"><span>ЁЯУК</span><span class="footer-label">Performance</span></button>
  <button class="footer-btn" onclick="window.open('tel:+916353511804')"><span>ЁЯУЮ</span><span class="footer-label">Call</span></button>
  <button class="footer-btn" onclick="window.open('https://wa.me/916353511804', '_blank')"><span>ЁЯТм</span><span class="footer-label">WhatsApp</span></button>
</footer>
<script>
const SUPABASE_URL = "https://bhmycvrbucmbbrpzeane.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4";
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
const SUBJECT_ID = '00000000-0000-0000-0000-000000000017';
const SUBJECT_CODE = 'CURRENT_AFFAIRS';
let currentUser = null;
let currentChapter = null;
init();
async function init() {
  try {
    const { data: { user } } = await sb.auth.getUser();
    currentUser = user;
    if (currentUser) {
      const { data: profile } = await sb.from('profiles').select('full_name').eq('id', currentUser.id).single();
      if (profile) {
        document.getElementById('userNameDisplay').innerText = profile.full_name.split(' ')[0];
        document.getElementById('userNameDisplay').style.display = 'block';
      }
    }
    await loadChapters();
  } catch (err) {
    console.error('Init error:', err);
  }
}
async function loadChapters() {
  try {
    const { data: chapters, error } = await sb.from('kls_chapters').select('*').eq('subject_id', SUBJECT_ID).order('chapter_code');
    if (error) throw error;
    if (!chapters || chapters.length === 0) {
      document.getElementById('chaptersHeader').innerHTML = '<div style="padding:12px;color:#fff">No chapters found</div>';
      return;
    }
    const chaptersHTML = chapters.map((ch, index) => `<div class="chapter-tab" data-code="${ch.chapter_code}" onclick="selectChapter('${ch.chapter_code}', '${ch.name}')">рккрлНрк░ркХрк░ркг ${index + 1}</div>`).join('');
    document.getElementById('chaptersHeader').innerHTML = chaptersHTML;
    if (chapters.length > 0) {
      selectChapter(chapters[0].chapter_code, chapters[0].name);
    }
  } catch (err) {
    console.error('Chapters error:', err);
    document.getElementById('chaptersHeader').innerHTML = '<div style="padding:12px;color:#fff">Error loading chapters</div>';
  }
}
async function selectChapter(chapterCode, chapterName) {
  currentChapter = chapterCode;
  document.getElementById('chapterTitle').style.display = 'block';
  document.getElementById('chapterTitle').querySelector('h2').innerText = chapterName;
  document.querySelectorAll('.chapter-tab').forEach(tab => {
    tab.classList.remove('active');
    if (tab.getAttribute('data-code') === chapterCode) {
      tab.classList.add('active');
      tab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    }
  });
  document.getElementById('quizList').innerHTML = `<div class="loading"><div class="spinner">тП│</div><h3>рк▓рлЛркбрк┐ркВркЧ ркеркИ рк░рк╣рлНркпрлБркВ ркЫрлЗ...</h3></div>`;
  await loadQuizzes(chapterCode);
}
async function loadQuizzes(chapterCode) {
  try {
    const { data, error } = await sb.from('kls_quizzes').select('*').eq('chapter_code', chapterCode).eq('is_active', true).order('difficulty_level');
    if (error) throw error;
    const quizList = document.getElementById('quizList');
    if (!data || data.length === 0) {
      quizList.innerHTML = `<div class="loading"><h3 style="color:#7f1d1d">ркЖ рккрлНрк░ркХрк░ркгркорк╛ркВ ркХрлЛркИ quiz ркиркерлА</h3><p style="font-size:14px;margin-top:8px">Quiz ркЬрк▓рлНркжрлА LIVE ркерк╢рлЗ</p></div>`;
      return;
    }
    quizList.innerHTML = data.map(quiz => {
      const difficultyClass = quiz.difficulty_level === 'рк╕рк░рк│' ? '' : quiz.difficulty_level === 'ркоркзрлНркпрко' ? 'medium' : 'hard';
      return `<div class="quiz-item" onclick="startQuiz('${quiz.quiz_id}')"><div class="quiz-header"><div class="quiz-name">${quiz.quiz_name}</div><div class="quiz-badge ${difficultyClass}">${quiz.difficulty_level}</div></div><div class="quiz-info"><div class="quiz-info-item"><span>ЁЯУЭ</span><span>${quiz.total_questions} рккрлНрк░рк╢рлНркирлЛ</span></div><div class="quiz-info-item"><span>тП▒я╕П</span><span>${quiz.time_limit} ркорк┐ркирк┐ркЯ</span></div></div></div>`;
    }).join('');
  } catch (err) {
    console.error('Quizzes error:', err);
    document.getElementById('quizList').innerHTML = `<div class="loading"><h3 style="color:#ef4444">Quiz рк▓рлЛркб ркХрк░рк╡рк╛ркорк╛ркВ рк╕ркорк╕рлНркпрк╛</h3><p style="font-size:14px;margin-top:8px">ркХрлГрккрк╛ ркХрк░рлАркирлЗ рклрк░рлА рккрлНрк░ркпрк╛рк╕ ркХрк░рлЛ</p></div>`;
  }
}
function startQuiz(quizId) {
  window.location.href = 'kls-quiz-engine.html?quiz_id=' + quizId;
}
</script>
</body>
</html>
