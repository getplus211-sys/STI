<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<title>STI Mock Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f8ff}
header{background:#0d6efd;color:#fff;padding:12px;display:flex;justify-content:space-between;align-items:center}
.card{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 6px #0002}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;padding:15px}
button{background:#0d6efd;color:#fff;border:none;padding:10px;border-radius:6px;width:100%}
button:disabled{background:#999}
footer{position:fixed;bottom:0;width:100%;background:#0d6efd;color:#fff;text-align:center;padding:10px}
a{color:#fff;text-decoration:none}
</style>
</head>

<body>

<header>
  <b>STI Mock Test</b>
  <span id="name">Student</span>
</header>

<div class="grid" id="cards"></div>

<footer>
<a href="https://wa.me/919925858057" target="_blank">Whatsapp Support</a>
</footer>

<script>
const supabase = supabase.createClient(
  "https://bhmycvrbucmbbrpzeane.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4"
);

(async()=>{
const {data:{user}}=await supabase.auth.getUser();
if(!user){alert("Login required");location.href="login.html";return;}

const {data:profile}=await supabase.from("profiles").select("full_name").eq("id",user.id).single();
document.getElementById("name").innerText=profile?.full_name||"Student";

const {data:access}=await supabase.from("user_access")
.select("*")
.eq("user_id",user.id)
.eq("plan_name","STI_MOCK")
.eq("is_active",true)
.single();

for(let i=1;i<=5;i++){
const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<h3>Mock Test ${i}</h3>
<p>200 Marks | 2 Hours<br>-0.33 Negative</p>
<button ${access?"disabled":""}>
${access?"Already Purchased":"Start Test"}
</button>`;
div.querySelector("button").onclick=()=>{
if(access) alert("Already purchased");
else location.href="mock-test-1.html?test="+i;
}
cards.appendChild(div);
}
})();
</script>
</body>
</html>
