<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STI Mock Test - рк╣рлЛрко рккрлЗркЬ</title>
    
    <style>
        /* ==================================== */
        /* 1. Global / Base Styles */
        /* ==================================== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f6f8fa;
            color: #24292e;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ==================================== */
        /* 2. Header (ркЯрлЛркЪркирлЛ ркнрк╛ркЧ) */
        /* ==================================== */
        .header {
            background-color: #24292e; /* ркШрлЗрк░рлЛ ркЧрлНрк░рлЗ/ркХрк╛рк│рлЛ */
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header .logo a {
            color: white;
            text-decoration: none;
            font-size: 1.5em;
            font-weight: bold;
        }

        .nav-links button {
            background-color: transparent;
            color: white;
            border: 1px solid white;
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-links button:hover {
            background-color: #3b4249;
        }

        /* рк▓рлЛркЧрк┐рки ркеркпрлЗрк▓ ркпрлБркЭрк░ ркорк╛ркЯрлЗ ркбрк┐рк╕рлНрккрлНрк▓рлЗ */
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 15px;
            font-size: 0.9em;
        }

        /* ==================================== */
        /* 3. Main Content (рк╡ркЪрк▓рлЛ ркнрк╛ркЧ) */
        /* ==================================== */
        .container {
            flex: 1;
            width: 90%;
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 15px;
        }

        .test-block {
            background-color: white;
            border: 1px solid #d1ddff;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .test-block h2 {
            color: #0366d6;
            margin-top: 0;
        }

        .test-block p {
            font-size: 1.1em;
            color: #586069;
        }

        .test-block .btn {
            background-color: #2da44e; /* рк▓рлАрк▓рлЛ рк░ркВркЧ */
            color: white;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            display: inline-block;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        .test-block .btn:hover {
            background-color: #2c974b;
        }

        /* ==================================== */
        /* 4. Footer (ркирлАркЪрлЗркирлЛ ркнрк╛ркЧ) */
        /* ==================================== */
        .footer {
            background-color: #24292e;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .footer p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .footer-contact a {
            color: #2da44e;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
        }

        .footer-contact a:hover {
            text-decoration: underline;
        }

        /* ркЖркЗркХрлЛрки рк╕рлНркЯрк╛ркЗрк▓ (ркдркорлЗ Font Awesome рк╡рк╛рккрк░рлА рк╢ркХрлЛ ркЫрлЛ, ркЕрк╣рлАркВ рк╕рк░рк│ркдрк╛ ркорк╛ркЯрлЗ ркЯрлЗркХрлНрк╕рлНркЯ/ркЗркорлЛркЬрлА ркирлЛ ркЙрккркпрлЛркЧ) */
        .footer-contact a::before {
            content: 'ЁЯУЮ'; 
            margin-right: 5px;
        }
        .footer-contact .whatsapp::before {
            content: 'ЁЯТм';
        }

        /* ==================================== */
        /* 5. Auth Modal (рк▓рлЛркЧрк┐рки/рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки рккрлЛрккркЕркк) */
        /* ==================================== */
        .modal {
            display: none; /* рк╢рк░рлВркЖркдркорк╛ркВ ркЫрлБрккрк╛ркпрлЗрк▓рлБркВ */
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .auth-form input {
            width: 100%;
            padding: 10px;
            margin: 8px 0 15px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .auth-form button {
            width: 100%;
            background-color: #0366d6;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        .auth-form button:hover {
            background-color: #0056b3;
        }
        
        .register-link {
            text-align: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .register-link button {
            background: none;
            border: none;
            color: #2da44e; /* рк▓рлАрк▓рлЛ рк░ркВркЧ */
            text-decoration: underline;
            padding: 5px;
            cursor: pointer;
            width: auto;
        }

        /* ==================================== */
        /* 6. Mobile Responsiveness */
        /* ==================================== */
        @media (max-width: 600px) {
            .header {
                flex-direction: column;
                padding: 10px;
            }

            .nav-links {
                margin-top: 10px;
            }
            
            .user-info {
                margin-bottom: 10px;
            }

            .nav-links button {
                margin: 5px 5px 0 0;
                padding: 6px 10px;
                font-size: 0.9em;
            }

            .container {
                width: 95%;
            }

            .test-block {
                padding: 20px;
            }
            
            .footer-contact a {
                display: block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <a href="index.html">STI Mock Test</a>
        </div>
        <nav class="nav-links">
            <div id="auth-buttons-unauthenticated">
                <button onclick="openModal('login')">ЁЯФТ рк▓рлЛркЧрк┐рки</button>
                <button onclick="openModal('register')">ЁЯУЭ рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки</button>
            </div>
            <div class="user-info" id="auth-buttons-authenticated" style="display: none;">
                <span id="user-display"></span>
                <button id="logout-btn" onclick="signOut()">ЁЯСЛ рк▓рлЛркЧркЖркЙркЯ</button>
            </div>
        </nav>
    </header>

    <div class="container">
        
        <h2>Mock Test Portal</h2>

        <div class="test-block">
            <h2>STI Style Demo Test (20 Marks)</h2>
            <p>ркЖ ркбрлЗркорлЛ ркЯрлЗрк╕рлНркЯ ркдркоркирлЗ рккрк░рлАркХрлНрк╖рк╛ркирк╛ ркмркВркзрк╛рк░ркгркирлЛ ркЦрлНркпрк╛рк▓ ркЖрккрк╡рк╛ ркорк╛ркЯрлЗ ркЫрлЗ. ркдрлЗ рк╕ркВрккрлВрк░рлНркгрккркгрлЗ ркорклркд ркЫрлЗ.</p>
            <a href="demo-test-page.html" class="btn">ркбрлЗркорлЛ ркЯрлЗрк╕рлНркЯ ркЖрккрлЛ</a>
        </div>

        <div class="test-block">
            <h2>5 рк╕ркВрккрлВрк░рлНркг Mock Tests (Premium)</h2>
            <p>рк╕рклрк│ркдрк╛ ркорк╛ркЯрлЗркирлА рк╕ркВрккрлВрк░рлНркг ркдрлИркпрк╛рк░рлА! 5 рккрлВрк░рлНркг-рк▓ркВркмрк╛ркИркирлА ркорлЛркХ ркЯрлЗрк╕рлНркЯ, ркЬрлЗ рк╕рлБркирк┐рк╢рлНркЪрк┐ркд рк░рлАркдрлЗ STI рккрк░рлАркХрлНрк╖рк╛ркирк╛ ркЕркнрлНркпрк╛рк╕ркХрлНрк░рко рккрк░ ркЖркзрк╛рк░рк┐ркд ркЫрлЗ.</p>
            <button class="btn" onclick="checkAuthAndNavigate('mock-test-page.html')">5 ркорлЛркХ ркЯрлЗрк╕рлНркЯ рк╢рк░рлВ ркХрк░рлЛ</button>
            <p style="font-size: 0.9em; margin-top: 10px; color: #d63384;">(ркЖ рк╕рлБрк╡рк┐ркзрк╛ рккрлЗркорлЗркирлНркЯ ркХрк░рлНркпрк╛ рккркЫрлА ркЬ ркЙрккрк▓ркмрлНркз ркерк╢рлЗ.)</p>
        </div>

    </div>

    <footer class="footer">
        <div class="footer-contact">
            <a href="https://wa.me/916353511804" target="_blank" class="whatsapp">рк╡рлЛркЯрлНрк╕ркПркк ркХрк░рлЛ</a>
            <a href="tel:+916353511804">Call: +91 63535 11804</a>
        </div>
        <p>&copy; 2025 STI Mock Test. All rights reserved.</p>
    </footer>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>

            <div id="login-view">
                <h2>ЁЯФТ рк▓рлЛркЧрк┐рки</h2>
                <form id="login-form" class="auth-form" onsubmit="handleLogin(event)">
                    <label for="login-email">ркИркорлЗркИрк▓:</label>
                    <input type="email" id="login-email" required>
                    
                    <label for="login-password">рккрк╛рк╕рк╡рк░рлНркб:</label>
                    <input type="password" id="login-password" required>
                    
                    <button type="submit">рк▓рлЛркЧрк┐рки ркХрк░рлЛ</button>
                </form>
                <div class="register-link">
                    ркирк╡рк╛ ркпрлБркЭрк░ ркЫрлЛ? <button onclick="switchToRegister()">ркЕрк╣рлАркВ рк░ркЬрлАрк╕рлНркЯрк░ ркХрк░рлЛ</button>
                </div>
            </div>

            <div id="register-view" style="display: none;">
                <h2>ЁЯУЭ рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки</h2>
                <form id="register-form" class="auth-form" onsubmit="handleRegister(event)">
                    <label for="reg-email">ркИркорлЗркИрк▓:</label>
                    <input type="email" id="reg-email" required>
                    
                    <label for="reg-password">рккрк╛рк╕рк╡рк░рлНркб:</label>
                    <input type="password" id="reg-password" required>
                    
                    <label for="reg-mobile">ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░ (+91):</label>
                    <input type="text" id="reg-mobile" required pattern="\+91\d{10}">
                    
                    <button type="submit">рк░ркЬрлАрк╕рлНркЯрк░ ркХрк░рлЛ</button>
                </form>
                <div class="register-link">
                    рккрк╣рлЗрк▓рлЗркерлА ркПркХрк╛ркЙркирлНркЯ ркЫрлЗ? <button onclick="switchToLogin()">рк▓рлЛркЧрк┐рки ркХрк░рлЛ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ====================================
        // 1. SUPABASE ркХркирлНрклрк┐ркЧрк░рлЗрк╢рки (ркдркорк╛рк░рлЗ ркЖ ркмркжрк▓рк╡рлБркВ рккркбрк╢рлЗ!)
        // ====================================
        const SUPABASE_URL = 'https://bhmycvrbucmbbrpzeane.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4';
        
        // Supabase ркХрлНрк▓рк╛ркпркирлНркЯ рк╢рк░рлВ ркХрк░рлЛ
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ====================================
        // 2. MODAL (POPUP) рклркВркХрлНрк╢ркирлНрк╕
        // ====================================
        const modal = document.getElementById('authModal');
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');

        function openModal(view) {
            modal.style.display = 'flex';
            if (view === 'login') {
                switchToLogin();
            } else if (view === 'register') {
                switchToRegister();
            }
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function switchToRegister() {
            loginView.style.display = 'none';
            registerView.style.display = 'block';
        }

        function switchToLogin() {
            loginView.style.display = 'block';
            registerView.style.display = 'none';
        }

        // ====================================
        // 3. AUTHENTICATION рклркВркХрлНрк╢ркирлНрк╕
        // ====================================

        // A. рк▓рлЛркЧрк┐рки рк╣рлЗркирлНркбрк▓рк░
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const { error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                alert('рк▓рлЛркЧрк┐рки ркирк┐рк╖рлНрклрк│: ' + error.message);
            } else {
                alert('рк▓рлЛркЧрк┐рки рк╕рклрк│! рк╕рлНрк╡рк╛ркЧркд ркЫрлЗ.');
                closeModal();
                checkUserStatus(); // рк╣рлЗркбрк░ ркЕрккркбрлЗркЯ ркХрк░рлЛ
            }
        }

        // B. рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки рк╣рлЗркирлНркбрк▓рк░
        async function handleRegister(event) {
            event.preventDefault();
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const mobile_number = document.getElementById('reg-mobile').value;

            // 1. Supabase Authentication (ркИркорлЗркИрк▓/рккрк╛рк╕рк╡рк░рлНркб)
            const { data: authData, error: authError } = await supabase.auth.signUp({ 
                email, 
                password 
            });

            if (authError) {
                alert('рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки ркирк┐рк╖рлНрклрк│: ' + authError.message);
                return;
            }

            // 2. Profile Table (ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░ рк╕рлЗрк╡ ркХрк░рк╡рлЛ)
            if (authData.user) {
                const { error: profileError } = await supabase
                    .from('profiles')
                    .insert({ 
                        id: authData.user.id, 
                        email: email, 
                        mobile_number: mobile_number 
                    });

                if (profileError) {
                    console.error('Mobile number save error:', profileError);
                    alert('рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки рк╕рклрк│, рккрк░ркВркдрлБ ркорлЛркмрк╛ркЗрк▓ ркиркВркмрк░ рк╕рлЗрк╡ ркХрк░рк╡рк╛ркорк╛ркВ ркнрлВрк▓ ркеркИ.');
                } else {
                    alert('рк░ркЬрлАрк╕рлНркЯрлНрк░рлЗрк╢рки рк╕рклрк│! ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркдркорк╛рк░рлЛ ркИркорлЗркИрк▓ ркЪрлЗркХ ркХрк░рлЛ ркЕркирлЗ рк▓рлЛркЧрк┐рки ркХрк░рлЛ.');
                    closeModal();
                    switchToLogin();
                }
            }
        }

        // C. рк▓рлЛркЧркЖркЙркЯ рклркВркХрлНрк╢рки
        async function signOut() {
            const { error } = await supabase.auth.signOut();
            if (error) {
                alert('рк▓рлЛркЧркЖркЙркЯ ркирк┐рк╖рлНрклрк│: ' + error.message);
            } else {
                alert('рк▓рлЛркЧркЖркЙркЯ рк╕рклрк│!');
                checkUserStatus(); 
            }
        }

        // D. рк╣рлЗркбрк░ ркЕрккркбрлЗркЯ рклркВркХрлНрк╢рки
        async function checkUserStatus() {
            const { data: { user } } = await supabase.auth.getUser();
            const authenticatedDiv = document.getElementById('auth-buttons-authenticated');
            const unauthenticatedDiv = document.getElementById('auth-buttons-unauthenticated');
            const userDisplay = document.getElementById('user-display');
            
            if (user) {
                // рк▓рлЛркЧрк┐рки ркеркпрлЗрк▓ ркЫрлЗ
                userDisplay.textContent = `${user.email}`; 
                authenticatedDiv.style.display = 'flex';
                unauthenticatedDiv.style.display = 'none';
            } else {
                // рк▓рлЛркЧрк┐рки ркеркпрлЗрк▓ ркиркерлА
                authenticatedDiv.style.display = 'none';
                unauthenticatedDiv.style.display = 'block';
            }
        }

        // E. Mock Test рккрк░ ркЬркдрк╛ рккрк╣рлЗрк▓рк╛ Auth Check
        async function checkAuthAndNavigate(targetPage) {
            const { data: { user } } = await supabase.auth.getUser();

            if (user) {
                // ркЬрлЛ ркпрлБркЭрк░ рк▓рлЛркЧрк┐рки рк╣рлЛркп, ркдрлЛ ркдрлЗркирлЗ Payment/Mock Test page рккрк░ ркЬрк╡рк╛ ркжрлЛ
                window.location.href = targetPage;
            } else {
                alert('Mock Tests рк╢рк░рлВ ркХрк░рк╡рк╛ ркорк╛ркЯрлЗ ркХрлГрккрк╛ ркХрк░рлАркирлЗ рккрк╣рлЗрк▓рк╛ рк▓рлЛркЧрк┐рки ркХрк░рлЛ.');
                openModal('login'); // рк▓рлЛркЧрк┐рки рккрлЛрккркЕркк ркЦрлЛрк▓рлЛ
            }
        }


        // ====================================
        // 4. Initialization
        // ====================================
        // рк╡рлЗркмрк╕рк╛ркИркЯ рк▓рлЛркб ркерк╛ркп ркдрлНркпрк╛рк░рлЗ ркпрлБркЭрк░ рк╕рлНркЯрлЗркЯрк╕ ркЪрлЗркХ ркХрк░рлЛ
        checkUserStatus();

        // ркХрлНрк▓рк┐ркХ ркХрк░рк╡рк╛ркерлА рккрлЛрккркЕркк ркмркВркз ркерк╛ркп
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>

</body>
</html>

