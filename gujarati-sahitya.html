<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>àª—à«àªœàª°àª¾àª¤à«€ àª¸àª¾àª¹àª¿àª¤à«àª¯ - KAPiLa Institute</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#f3f4f6;padding-top:130px;padding-bottom:70px}

/* Header */
.header{position:fixed;top:0;left:0;right:0;z-index:1000;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
.header-top{padding:12px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e5e7eb}
.brand{flex:1}
.brand-name{font-size:18px;font-weight:bold;color:#ea580c;line-height:1.2}
.brand-subtitle{font-size:10px;color:#ea580c}
.header-right{display:flex;align-items:center;gap:8px}
.register-btn{background:#2563eb;color:#fff;padding:8px 16px;border-radius:20px;font-size:11px;font-weight:bold;border:none;cursor:pointer}
.menu-btn{width:40px;height:40px;background:#f3f4f6;border-radius:8px;border:none;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer}
.user-name{font-size:12px;font-weight:bold;color:#1f2937}

/* Chapters Horizontal Scroll */
.chapters-header{overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding:12px 16px;background:#fff;-webkit-overflow-scrolling:touch}
.chapters-header::-webkit-scrollbar{height:4px}
.chapters-header::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}
.chapter-tab{display:inline-block;padding:8px 16px;margin-right:8px;background:#f3f4f6;border-radius:20px;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;transition:all 0.2s;border:2px solid transparent}
.chapter-tab:hover{background:#e5e7eb}
.chapter-tab.active{background:#2563eb;color:#fff;border-color:#2563eb}
.chapter-tab.loading{background:#f3f4f6;color:#9ca3af;cursor:wait}

/* Footer */
.footer{position:fixed;bottom:0;left:0;right:0;z-index:1000;background:#fff;padding:12px 16px;box-shadow:0 -2px 10px rgba(0,0,0,0.1);display:flex;justify-content:space-around;align-items:center}
.footer-btn{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:24px;color:#6b7280;cursor:pointer;position:relative}
.footer-btn.active{color:#2563eb}
.footer-label{font-size:9px;font-weight:600}
.notification-badge{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;font-size:9px;padding:2px 5px;border-radius:10px;font-weight:bold}

/* Container */
.container{padding:0 16px;max-width:600px;margin:0 auto}

/* Chapter Title */
.chapter-title{background:#fff;padding:16px;margin:16px 16px 0 16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.chapter-title h2{font-size:18px;color:#1f2937;font-weight:600;line-height:1.4}

/* Quiz List */
.quiz-list{padding:16px}
.quiz-item{background:#fff;padding:16px;margin-bottom:12px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.08);cursor:pointer;transition:all 0.2s}
.quiz-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.15);transform:translateY(-2px)}
.quiz-item:active{transform:translateY(0)}
.quiz-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.quiz-name{font-size:16px;font-weight:600;color:#1f2937}
.quiz-badge{background:#22c55e;color:#fff;font-size:11px;padding:4px 10px;border-radius:12px;font-weight:600}
.quiz-badge.medium{background:#f59e0b}
.quiz-badge.hard{background:#ef4444}
.quiz-info{display:flex;gap:16px;margin-top:8px}
.quiz-info-item{display:flex;align-items:center;gap:6px;font-size:13px;color:#6b7280}

/* Loading State */
.loading{text-align:center;padding:60px 20px;color:#6b7280}
.spinner{font-size:48px;margin:0 auto 16px;animation:spin 2s linear infinite;display:inline-block}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.loading h3{margin-top:16px;font-size:16px;font-weight:500}

/* Side Menu */
.side-menu{position:fixed;top:0;right:-280px;width:280px;height:100%;background:#fff;z-index:2000;transition:right 0.3s;box-shadow:-2px 0 10px rgba(0,0,0,0.1);overflow-y:auto}
.side-menu.open{right:0}
.menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1999;display:none}
.menu-overlay.show{display:block}
.menu-header{padding:20px;background:linear-gradient(135deg,#2563eb,#4f46e5);color:#fff;position:relative}
.menu-header h3{font-size:18px;margin-bottom:4px}
.menu-header p{font-size:12px;opacity:0.9}
.menu-close{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:24px;width:32px;height:32px;border-radius:8px;cursor:pointer}
.menu-items{padding:12px 0}
.menu-item{padding:16px 20px;border-bottom:1px solid #f3f4f6;cursor:pointer;display:flex;align-items:center;gap:12px}
.menu-item:hover{background:#f9fafb}
.menu-icon{font-size:24px;width:40px;text-align:center}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:3000;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
.modal.show{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:400px;width:100%;padding:24px;max-height:90vh;overflow-y:auto;margin:auto}
.modal-header{display:flex;align-items:center;margin-bottom:20px}
.modal-logo{width:50px;height:50px;background:linear-gradient(135deg,#ea580c,#dc2626);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;margin-right:12px;flex-shrink:0}
.modal-title-wrap{flex:1}
.modal-brand{font-size:18px;font-weight:bold;color:#ea580c}
.modal-subtitle{font-size:11px;color:#6b7280}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:12px;font-weight:600;margin-bottom:6px;color:#374151}
.form-input{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
.btn-primary{width:100%;background:#2563eb;color:#fff;padding:12px;border-radius:8px;font-size:14px;font-weight:bold;border:none;cursor:pointer}
.btn-primary:hover{background:#1d4ed8}
.btn-secondary{width:100%;background:#f3f4f6;color:#1f2937;padding:12px;border-radius:8px;font-size:14px;font-weight:600;border:none;cursor:pointer;margin-top:8px}
.btn-link{background:none;border:none;color:#2563eb;font-size:12px;cursor:pointer;text-decoration:underline;margin-top:8px;width:100%;text-align:center}
.tabs{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:20px}
.tab{flex:1;padding:12px;text-align:center;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px}
.tab.active{color:#2563eb;border-bottom-color:#2563eb}
.tab-content{display:none}
.tab-content.active{display:block}
.success-popup{background:#fff;border-radius:16px;padding:30px;text-align:center;max-width:350px}
.success-icon{font-size:60px;margin-bottom:16px}
.success-title{font-size:20px;font-weight:bold;margin-bottom:8px}
.success-text{font-size:14px;color:#6b7280;margin-bottom:20px}
.info-row{background:#f9fafb;padding:12px;border-radius:8px;margin:8px 0;display:flex;align-items:center;gap:12px}
.info-label{font-size:11px;color:#6b7280;margin-bottom:2px}
.info-value{font-size:14px;font-weight:600;color:#1f2937}
</style>
</head>
<body>

<header class="header">
  <div class="header-top">
    <div class="brand">
      <div class="brand-name">àª—à«àªœàª°àª¾àª¤à«€ àª¸àª¾àª¹àª¿àª¤à«àª¯</div>
      <div class="brand-subtitle">KAPiLa Institute</div>
    </div>
    <div class="header-right">
      <button id="registerBtn" class="register-btn" onclick="openAuthModal()">Register</button>
      <span id="userNameDisplay" class="user-name" style="display:none"></span>
      <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
    </div>
  </div>
  <div class="chapters-header" id="chaptersHeader">
    <div class="loading" style="padding:12px 0">
      <span class="spinner" style="font-size:20px;margin:0">â±ï¸</span>
    </div>
  </div>
</header>

<div class="container">
  <div class="chapter-title" id="chapterTitle" style="display:none">
    <h2></h2>
  </div>
  <div class="quiz-list" id="quizList">
    <div class="loading">
      <div class="spinner">â±ï¸</div>
      <h3>àªªà«àª°àª•àª°àª£ àªªàª¸àª‚àª¦ àª•àª°à«‹</h3>
    </div>
  </div>
</div>

<footer class="footer">
  <button class="footer-btn" onclick="navigateFooter('home')">
    <span>ğŸ </span>
    <span class="footer-label">Home</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('performance')">
    <span>ğŸ“Š</span>
    <span class="footer-label">Performance</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('account')">
    <span>ğŸ‘¤</span>
    <span class="footer-label">Account</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('contact')">
    <span>ğŸ“</span>
    <span class="footer-label">Contact</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('notification')">
    <span>ğŸ””</span>
    <span class="footer-label">Notifications</span>
    <span id="notificationBadge" class="notification-badge" style="display:none">0</span>
  </button>
</footer>

<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
  <div class="menu-header">
    <button class="menu-close" onclick="toggleMenu()">Ã—</button>
    <h3>KAPiLa Institute</h3>
    <p>Digital Learning Platform</p>
  </div>
  <div class="menu-items">
    <div class="menu-item" id="registerMenuItem" onclick="menuNavigate('register')">
      <span class="menu-icon">âœï¸</span>
      <span>Register</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('home')">
      <span class="menu-icon">ğŸ </span>
      <span>Home</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('about')">
      <span class="menu-icon">â„¹ï¸</span>
      <span>About Us</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('privacy')">
      <span class="menu-icon">ğŸ”’</span>
      <span>Privacy Policy</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('terms')">
      <span class="menu-icon">ğŸ“„</span>
      <span>Terms & Conditions</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('contact')">
      <span class="menu-icon">ğŸ“</span>
      <span>Contact Us</span>
    </div>
    <div class="menu-item" id="logoutMenuItem" style="display:none" onclick="handleLogout()">
      <span class="menu-icon">ğŸšª</span>
      <span>Logout</span>
    </div>
  </div>
</div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Digital Learning Platform</div>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" onclick="switchAuthTab('login')">Login</div>
      <div class="tab" onclick="switchAuthTab('register')">Register</div>
    </div>
    <div id="loginTab" class="tab-content active">
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" required>
        </div>
        <button type="submit" class="btn-primary">Login</button>
        <button type="button" class="btn-link" onclick="showForgotPassword()">Forgot Password?</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
    <div id="registerTab" class="tab-content">
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="registerName" required>
        </div>
        <div class="form-group">
          <label class="form-label">Mobile Number</label>
          <input type="tel" class="form-input" id="registerMobile" pattern="[0-9]{10}" placeholder="10 digit mobile number" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="registerEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="registerPassword" required minlength="6">
        </div>
        <button type="submit" class="btn-primary">Register</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
  </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal" id="forgotPasswordModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ”‘</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">Reset Password</div>
        <div class="modal-subtitle">We'll send you a reset link</div>
      </div>
    </div>
    <form onsubmit="handleForgotPassword(event)">
      <div class="form-group">
        <label class="form-label">Email Address</label>
        <input type="email" class="form-input" id="forgotEmail" required>
      </div>
      <button type="submit" class="btn-primary">Send Reset Link</button>
      <button type="button" class="btn-secondary" onclick="closeForgotPassword()">Cancel</button>
    </form>
  </div>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal">
  <div class="success-popup">
    <div class="success-icon" id="successIcon">âœ…</div>
    <div class="success-title" id="successTitle">Success!</div>
    <div class="success-text" id="successText">Operation completed successfully</div>
    <button class="btn-primary" onclick="closeSuccessModal()">OK</button>
  </div>
</div>

<!-- Contact Modal -->
<div class="modal" id="contactModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">Contact Us</div>
        <div class="modal-subtitle">Get in touch</div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ“§</span>
      <div style="flex:1">
        <div class="info-label">Email</div>
        <div class="info-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2a4945445e4b495e6a414b5a43464b4344595e435e5f5e4f04494547">[email&#160;protected]</a></div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ“±</span>
      <div style="flex:1">
        <div class="info-label">Phone</div>
        <div class="info-value">+91 98765 43210</div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ“</span>
      <div style="flex:1">
        <div class="info-label">Address</div>
        <div class="info-value">KAPiLa Institute, Gujarat, India</div>
      </div>
    </div>
    <button class="btn-primary" onclick="closeContactModal()" style="margin-top:16px">Close</button>
  </div>
</div>

<!-- About Modal -->
<div class="modal" id="aboutModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">â„¹ï¸</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">About Us</div>
        <div class="modal-subtitle">KAPiLa Institute</div>
      </div>
    </div>
    <div style="line-height:1.6;color:#374151">
      <p style="margin-bottom:12px">
        KAPiLa Institute is a leading digital learning platform providing quality education to students across Gujarat.
      </p>
      <p style="margin-bottom:12px">
        We offer comprehensive courses, expert guidance, and a user-friendly interface to help students achieve their academic goals.
      </p>
      <p>
        Join thousands of successful students who have transformed their learning journey with KAPiLa Institute.
      </p>
    </div>
    <button class="btn-primary" onclick="closeAboutModal()" style="margin-top:20px">Close</button>
  </div>
</div>

<!-- Account Modal -->
<div class="modal" id="accountModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ‘¤</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">My Account</div>
        <div class="modal-subtitle">Your profile information</div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ‘¤</span>
      <div style="flex:1">
        <div class="info-label">Name</div>
        <div class="info-value" id="accountName">--</div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ“§</span>
      <div style="flex:1">
        <div class="info-label">Email</div>
        <div class="info-value" id="accountEmail">--</div>
      </div>
    </div>
    <div class="info-row">
      <span style="font-size:24px">ğŸ“±</span>
      <div style="flex:1">
        <div class="info-label">Mobile</div>
        <div class="info-value" id="accountMobile">--</div>
      </div>
    </div>
    <button class="btn-primary" onclick="closeAccountModal()" style="margin-top:16px">Close</button>
  </div>
</div>

<!-- Notification Modal -->
<div class="modal" id="notificationModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ””</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">Notifications</div>
        <div class="modal-subtitle">Stay updated</div>
      </div>
    </div>
    <div style="text-align:center;padding:20px;color:#6b7280">
      <p>No new notifications</p>
    </div>
    <button class="btn-primary" onclick="closeNotificationModal()">Close</button>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// Supabase Credentials
const SUPABASE_URL = 'https://bhmycvrbucmbbrpzeane.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let allChapters = [];
let currentChapterCode = null;

async function init() {
  const { data: { user } } = await sb.auth.getUser();
  currentUser = user;
  
  if (currentUser) {
    const { data: profile } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
    document.getElementById('registerBtn').style.display = 'none';
    document.getElementById('userNameDisplay').style.display = 'block';
    document.getElementById('userNameDisplay').innerText = profile?.full_name || currentUser.email.split('@')[0];
    document.getElementById('registerMenuItem').style.display = 'none';
    document.getElementById('logoutMenuItem').style.display = 'flex';
  }
  
  await loadChapters();
}

async function loadChapters() {
  try {
    const { data, error } = await sb
      .from('kls_chapters')
      .select('*')
      .eq('subject_id', '00000000-0000-0000-0000-000000000014');
    
    if (error) throw error;
    
    if (!data || data.length === 0) {
      document.getElementById('chaptersHeader').innerHTML = '<div style="padding:12px;color:#6b7280;font-size:13px">àª•à«‹àªˆ àªªà«àª°àª•àª°àª£à«‹ àª¨àª¥à«€</div>';
      return;
    }
    
    // Sort by number
    allChapters = data.sort((a, b) => {
      const numA = parseInt(a.number) || 0;
      const numB = parseInt(b.number) || 0;
      return numA - numB;
    });
    
    // Create chapter tabs
    const chaptersHTML = allChapters.map((chapter, index) => {
      const chapterNum = chapter.chapter_code.split('_').pop(); // Extract "01" from "GUJ_SAH_01"
      return `<span class="chapter-tab ${index === 0 ? 'active' : ''}" onclick="selectChapter('${chapter.chapter_code}')" data-code="${chapter.chapter_code}">àªªà«àª°àª•àª°àª£ ${chapterNum}</span>`;
    }).join('');
    
    document.getElementById('chaptersHeader').innerHTML = chaptersHTML;
    
    // Load first chapter's quizzes automatically
    if (allChapters.length > 0) {
      selectChapter(allChapters[0].chapter_code);
    }
    
  } catch (err) {
    document.getElementById('chaptersHeader').innerHTML = '<div style="padding:12px;color:#ef4444;font-size:13px">Error loading chapters</div>';
  }
}

async function selectChapter(chapterCode) {
  currentChapterCode = chapterCode;
  
  // Find selected chapter
  const selectedChapter = allChapters.find(ch => ch.chapter_code === chapterCode);
  
  // Update chapter title
  const chapterTitle = document.getElementById('chapterTitle');
  if (selectedChapter) {
    chapterTitle.style.display = 'block';
    chapterTitle.querySelector('h2').innerText = selectedChapter.name;
  }
  
  // Update active tab
  document.querySelectorAll('.chapter-tab').forEach(tab => {
    tab.classList.remove('active');
    if (tab.getAttribute('data-code') === chapterCode) {
      tab.classList.add('active');
      tab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    }
  });
  
  // Show loading
  document.getElementById('quizList').innerHTML = `
    <div class="loading">
      <div class="spinner">â±ï¸</div>
      <h3>àª²à«‹àª¡àª¿àª‚àª— àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...</h3>
    </div>
  `;
  
  // Load quizzes for this chapter
  await loadQuizzes(chapterCode);
}

async function loadQuizzes(chapterCode) {
  try {
    const { data, error } = await sb
      .from('kls_quizzes')
      .select('*')
      .eq('chapter_code', chapterCode)
      .eq('is_active', true);
    
    if (error) throw error;
    
    const quizList = document.getElementById('quizList');
    
    if (!data || data.length === 0) {
      quizList.innerHTML = `
        <div class="loading">
          <h3 style="color:#6b7280">àª† àªªà«àª°àª•àª°àª£àª®àª¾àª‚ àª•à«‹àªˆ quiz àª¨àª¥à«€</h3>
        </div>
      `;
      return;
    }
    
    quizList.innerHTML = data.map(quiz => {
      const difficultyClass = quiz.difficulty_level === 'easy' ? '' : 
                              quiz.difficulty_level === 'medium' ? 'medium' : 'hard';
      const difficultyText = quiz.difficulty_level === 'easy' ? 'àª¸àª°àª³' :
                            quiz.difficulty_level === 'medium' ? 'àª®àª§à«àª¯àª®' : 'àª®à«àª¶à«àª•à«‡àª²';
      
      return `
        <div class="quiz-item" onclick="startQuiz('${quiz.id}')">
          <div class="quiz-header">
            <div class="quiz-name">${quiz.quiz_name}</div>
            <div class="quiz-badge ${difficultyClass}">${difficultyText}</div>
          </div>
          <div class="quiz-info">
            <div class="quiz-info-item">
              <span>ğŸ“</span>
              <span>${quiz.total_questions} àªªà«àª°àª¶à«àª¨à«‹</span>
            </div>
            <div class="quiz-info-item">
              <span>â±ï¸</span>
              <span>${quiz.time_limit} àª®àª¿àª¨àª¿àªŸ</span>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
  } catch (err) {
    document.getElementById('quizList').innerHTML = `
      <div class="loading">
        <h3 style="color:#ef4444">Quiz àª²à«‹àª¡ àª•àª°àªµàª¾àª®àª¾àª‚ àª¸àª®àª¸à«àª¯àª¾</h3>
        <p style="font-size:14px;margin-top:8px;color:#6b7280">àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª«àª°à«€ àªªà«àª°àª¯àª¾àª¸ àª•àª°à«‹</p>
      </div>
    `;
  }
}

function startQuiz(quizId) {
  // Redirect to KLS Quiz Engine
  window.location.href = 'kls-quiz-engine.html?quiz_id=' + quizId;
}

function checkAuthAndNavigate(url) {
  if (!currentUser) {
    openAuthModal();
    return;
  }
  window.location.href = url;
}

function toggleMenu() {
  document.getElementById('sideMenu').classList.toggle('open');
  document.getElementById('menuOverlay').classList.toggle('show');
}

function menuNavigate(page) {
  toggleMenu();
  if (page === 'home') window.location.href = 'index-kapila.html';
  else if (page === 'register') openAuthModal();
  else if (page === 'about') showAboutPopup();
  else if (page === 'privacy') window.location.href = 'privacy-policy.html';
  else if (page === 'terms') window.location.href = 'terms-and-conditions.html';
  else if (page === 'contact') showContactPopup();
}

function navigateFooter(page) {
  document.querySelectorAll('.footer-btn').forEach(btn => btn.classList.remove('active'));
  event.target.closest('.footer-btn').classList.add('active');
  
  if (page === 'home') window.location.href = 'index-kapila.html';
  else if (page === 'performance') checkAuthAndNavigate('overall-performance.html');
  else if (page === 'account') showAccountPopup();
  else if (page === 'contact') showContactPopup();
  else if (page === 'notification') showNotificationPopup();
}

function openAuthModal() {
  document.getElementById('authModal').classList.add('show');
}

function closeAuthModal() {
  document.getElementById('authModal').classList.remove('show');
}

function switchAuthTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

async function handleLogin(e) {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  
  const { error } = await sb.auth.signInWithPassword({ email, password });
  
  if (error) {
    alert('Login Error: ' + error.message);
  } else {
    closeAuthModal();
    showSuccessPopup('ğŸ‰', 'Login Successful!', 'Welcome to KAPiLa Institute');
    setTimeout(() => window.location.reload(), 2000);
  }
}

async function handleRegister(e) {
  e.preventDefault();
  const name = document.getElementById('registerName').value;
  const mobile = document.getElementById('registerMobile').value;
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  
  const { data: authData, error: authError } = await sb.auth.signUp({ email, password });
  
  if (authError) {
    alert('Registration Error: ' + authError.message);
    return;
  }
  
  if (authData.user) {
    await sb.from('profiles').update({ 
      full_name: name,
      mobile: mobile,
      updated_at: new Date().toISOString()
    }).eq('id', authData.user.id);
  }
  
  closeAuthModal();
  showSuccessPopup('âœ…', 'Registration Successful!', 'Welcome to KAPiLa Institute! Please check your email.');
  setTimeout(() => window.location.reload(), 2000);
}

function showForgotPassword() {
  closeAuthModal();
  document.getElementById('forgotPasswordModal').classList.add('show');
}

function closeForgotPassword() {
  document.getElementById('forgotPasswordModal').classList.remove('show');
}

async function handleForgotPassword(e) {
  e.preventDefault();
  const email = document.getElementById('forgotEmail').value;
  
  const { error } = await sb.auth.resetPasswordForEmail(email, {
    redirectTo: window.location.origin + '/reset-password.html'
  });
  
  if (error) {
    alert('Error: ' + error.message);
  } else {
    closeForgotPassword();
    showSuccessPopup('ğŸ“§', 'Email Sent!', 'àª¤àª®àª¾àª°àª¾ email check àª•àª°à«‹. àª¤àª®àª¨à«‡ password reset link àª®àª³à«àª¯à«‹ àª›à«‡. àª¤à«àª¯àª¾àª‚àª¥à«€ àª¨àªµà«‹ password àª¬àª¨àª¾àªµà«‹ àª…àª¨à«‡ àª«àª°à«€àª¥à«€ login àª•àª°à«‹.');
  }
}

async function handleLogout() {
  await sb.auth.signOut();
  showSuccessPopup('ğŸ‘‹', 'Logout Successful!', 'àª†àªªàª¨à«‹ àª†àª­àª¾àª°! àª«àª°à«€ àª®àª³à«€àª¶à«àª‚.');
  setTimeout(() => window.location.reload(), 2000);
}

function showSuccessPopup(icon, title, text) {
  document.getElementById('successIcon').innerText = icon;
  document.getElementById('successTitle').innerText = title;
  document.getElementById('successText').innerText = text;
  document.getElementById('successModal').classList.add('show');
}

function closeSuccessModal() {
  document.getElementById('successModal').classList.remove('show');
}

function showContactPopup() {
  document.getElementById('contactModal').classList.add('show');
}

function closeContactModal() {
  document.getElementById('contactModal').classList.remove('show');
}

function showAboutPopup() {
  document.getElementById('aboutModal').classList.add('show');
}

function closeAboutModal() {
  document.getElementById('aboutModal').classList.remove('show');
}

async function showAccountPopup() {
  if (!currentUser) {
    openAuthModal();
    return;
  }
  
  const { data: profile } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
  
  document.getElementById('accountName').innerText = profile?.full_name || '--';
  document.getElementById('accountEmail').innerText = currentUser.email || '--';
  document.getElementById('accountMobile').innerText = profile?.mobile || '--';
  
  document.getElementById('accountModal').classList.add('show');
}

function closeAccountModal() {
  document.getElementById('accountModal').classList.remove('show');
}

function showNot
