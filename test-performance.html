<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LRD Beginners - ટેસ્ટ Performance</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@300;400;600;700&display=swap');
        
        body {
            margin: 0;
            font-family: 'Hind Vadodara', sans-serif;
            background-color: #f0f2f5;
        }
        
        .subject-card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        
        nav {
            background: #1e40af;
            color: white;
            padding: 16px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-logo {
            background: white;
            color: #1e40af;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .nav-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Hind Vadodara', sans-serif;
        }
        
        .nav-btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .profile-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .profile-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .profile-info p {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 600;
            margin: 0 0 5px 0;
        }
        
        .profile-info h2 {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
            margin: 0;
        }
        
        .profile-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-badge {
            background: #fed7aa;
            color: #ea580c;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 900;
            color: #1e40af;
        }
        
        .stat-date {
            font-size: 16px;
            font-weight: bold;
            color: #475569;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .chart-title {
            font-weight: bold;
            color: #475569;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-container {
            width: 100%;
            max-width: 250px;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }
        
        .stats-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stats-card-label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
        }
        
        .stats-card-value {
            font-size: 20px;
            font-weight: 900;
            color: #1e293b;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .subject-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        
        .subject-header {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .subject-title {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
            margin: 0;
        }
        
        .proficiency-badge {
            color: white;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .subject-body {
            padding: 16px;
        }
        
        .subject-body table {
            width: 100%;
            text-align: left;
            font-size: 14px;
        }
        
        .subject-body thead {
            color: #64748b;
            text-transform: uppercase;
            font-size: 11px;
        }
        
        .subject-body th {
            padding-bottom: 12px;
            font-weight: 700;
        }
        
        .subject-body tbody tr {
            border-bottom: 1px solid #f1f5f9;
        }
        
        .subject-body tbody tr:last-child {
            border-bottom: none;
        }
        
        .subject-body td {
            padding: 10px 0;
            color: #475569;
            font-weight: 500;
        }
        
        .result-excellent {
            color: #22c55e !important;
            font-weight: bold !important;
        }
        
        .result-good {
            color: #84cc16 !important;
            font-weight: bold !important;
        }
        
        .result-average {
            color: #f59e0b !important;
            font-weight: bold !important;
        }
        
        .result-poor {
            color: #ef4444 !important;
            font-weight: bold !important;
        }
        
        .action-plan-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            padding: 32px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            margin-bottom: 24px;
        }
        
        .action-plan-bg {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 64px;
            opacity: 0.1;
        }
        
        .action-plan-title {
            font-size: 20px;
            font-weight: bold;
            color: #fbbf24;
            border-bottom: 2px solid #334155;
            padding-bottom: 12px;
            margin-bottom: 24px;
        }
        
        .action-plan-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .action-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
        }
        
        .action-section h4 {
            font-size: 14px;
            color: #93c5fd;
            text-transform: uppercase;
            font-weight: 700;
            margin: 0 0 16px 0;
        }
        
        .action-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .action-list li {
            padding: 10px 0;
            color: #cbd5e1;
            font-size: 14px;
            display: flex;
            align-items: start;
            gap: 10px;
            line-height: 1.6;
        }
        
        .action-list i {
            color: #22c55e;
            margin-top: 3px;
        }
        
        .goal-card {
            background: white;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .goal-text {
            color: #1e293b;
            font-style: italic;
            font-weight: 600;
            font-size: 16px;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .profile-section {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .subjects-grid {
                grid-template-columns: 1fr;
            }
            
            .action-plan-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-left">
            <div class="nav-logo">LRD</div>
            <h1 class="nav-title">Beginners - ટેસ્ટ Performance</h1>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="window.location.href='dashboard.html'">
                <i class="fas fa-home"></i> હોમ
            </button>
            <button class="nav-btn" onclick="window.location.href='overall-performance.html'">
                <i class="fas fa-chart-bar"></i> Overall Performance
            </button>
        </div>
    </nav>

    <div class="container">
        <div id="app">
            <div class="card">
                <p style="text-align: center; color: #64748b;">લોડ કરી રહ્યા છીએ...</p>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const app = document.getElementById('app');
        let pieChart = null;

        // Get result ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const resultId = urlParams.get('result_id');

        // Initialize
        async function init() {
            if (!resultId) {
                showError('કોઈ result ID મળી નથી', false);
                return;
            }

            try {
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                
                if (authError || !user) {
                    showError('તમે લોગિન થયેલ નથી', false);
                    setTimeout(() => window.location.href = 'login.html', 2000);
                    return;
                }

                await loadTestPerformance(user.id, resultId);
            } catch (error) {
                console.error('Init error:', error);
                showError('કંઈક ખોટું થયું. કૃપા કરીને ફરી પ્રયાસ કરો.');
            }
        }

        async function loadTestPerformance(userId, resultId) {
            try {
                // Load profile
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();

                if (profileError) throw profileError;

                // Load test result with test details
                const { data: result, error: resultError } = await supabase
                    .from('lrd_test_results')
                    .select(`
                        *,
                        lrd_tests (
                            id,
                            title,
                            total_marks,
                            target_score,
                            duration_minutes
                        )
                    `)
                    .eq('id', resultId)
                    .eq('user_id', userId)
                    .single();

                if (resultError) throw resultError;

                if (!result) {
                    showError('આ test result મળી નથી', false);
                    return;
                }

                // Load question responses with subject and chapter details
                const { data: responses, error: responsesError } = await supabase
                    .from('lrd_question_responses')
                    .select(`
                        *,
                        lrd_questions (
                            id,
                            chapter_id,
                            chapter_code,
                            difficulty_level,
                            lrd_chapters (
                                id,
                                name,
                                chapter_code,
                                subject_id,
                                lrd_subjects (
                                    id,
                                    name,
                                    subject_code
                                )
                            )
                        )
                    `)
                    .eq('result_id', resultId);

                if (responsesError) throw responsesError;

                // Calculate subject and chapter-wise performance
                const subjectData = calculateSubjectChapterPerformance(responses);

                // Get suggestions from rule engine
                const suggestions = await getSuggestions(result.subject_id, subjectData, result);

                // Calculate answer statistics
                const totalQuestions = responses.length;
                const correctAnswers = responses.filter(r => r.is_correct).length;
                const wrongAnswers = responses.filter(r => !r.is_correct && r.user_selected_option).length;
                const skipped = responses.filter(r => !r.user_selected_option).length;

                // Render the dashboard
                renderDashboard(profile, result, subjectData, suggestions, {
                    correct: correctAnswers,
                    wrong: wrongAnswers,
                    skipped: skipped,
                    total: totalQuestions
                });

            } catch (error) {
                console.error('Load error:', error);
                showError('ડેટા લોડ કરવામાં સમસ્યા આવી.');
            }
        }

        function calculateSubjectChapterPerformance(responses) {
            const subjectMap = {};

            responses.forEach(response => {
                if (!response.lrd_questions?.lrd_chapters?.lrd_subjects) return;

                const subject = response.lrd_questions.lrd_chapters.lrd_subjects;
                const chapter = response.lrd_questions.lrd_chapters;

                if (!subjectMap[subject.id]) {
                    subjectMap[subject.id] = {
                        id: subject.id,
                        name: subject.name,
                        subject_code: subject.subject_code,
                        total: 0,
                        correct: 0,
                        chapters: {}
                    };
                }

                subjectMap[subject.id].total++;
                if (response.is_correct) {
                    subjectMap[subject.id].correct++;
                }

                // Chapter-wise tracking
                if (!subjectMap[subject.id].chapters[chapter.id]) {
                    subjectMap[subject.id].chapters[chapter.id] = {
                        id: chapter.id,
                        name: chapter.name,
                        chapter_code: chapter.chapter_code,
                        total: 0,
                        correct: 0
                    };
                }

                subjectMap[subject.id].chapters[chapter.id].total++;
                if (response.is_correct) {
                    subjectMap[subject.id].chapters[chapter.id].correct++;
                }
            });

            // Convert to array
            return Object.values(subjectMap).map(subject => ({
                ...subject,
                chapters: Object.values(subject.chapters)
            }));
        }

        async function getSuggestions(subjectId, subjectData, result) {
            // Get suggestions from rule engine based on performance
            const suggestions = [];

            for (const subject of subjectData) {
                const accuracy = (subject.correct / subject.total) * 100;

                // Get rule engine suggestions for this subject
                const { data: rules, error } = await supabase
                    .from('lrd_rule_engine')
                    .select('*')
                    .eq('subject_id', subject.id)
                    .lte('min_score', accuracy)
                    .gte('max_score', accuracy)
                    .order('priority', { ascending: true });

                if (!error && rules && rules.length > 0) {
                    suggestions.push(...rules);
                }

                // Add chapter-specific suggestions for weak chapters
                for (const chapter of subject.chapters) {
                    const chapterAccuracy = (chapter.correct / chapter.total) * 100;
                    if (chapterAccuracy < 50) {
                        const { data: chapterRules, error: chapterError } = await supabase
                            .from('lrd_rule_engine')
                            .select('*')
                            .eq('chapter_code', chapter.chapter_code)
                            .lte('min_score', chapterAccuracy)
                            .gte('max_score', chapterAccuracy)
                            .order('priority', { ascending: true });

                        if (!chapterError && chapterRules && chapterRules.length > 0) {
                            suggestions.push(...chapterRules);
                        }
                    }
                }
            }

            return suggestions;
        }

        function renderDashboard(profile, result, subjectData, suggestions, answerStats) {
            const initials = profile.full_name
                ? profile.full_name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()
                : 'U';

            const test = result.lrd_tests;
            const testDate = new Date(result.created_at).toLocaleDateString('gu-IN');
            
            const avgTimePerQ = result.avg_time_per_question 
                ? result.avg_time_per_question.toFixed(0) 
                : result.total_time_taken_seconds 
                    ? Math.floor(result.total_time_taken_seconds / answerStats.total)
                    : 0;

            const correctAnswers = answerStats.correct;
            const wrongAnswers = answerStats.wrong;
            const skipped = answerStats.skipped;

            app.innerHTML = `
                <div class="card">
                    <div class="profile-section">
                        <div class="profile-left">
                            <div class="avatar">${initials}</div>
                            <div class="profile-info">
                                <p>વિદ્યાર્થી</p>
                                <h2>${profile.full_name || 'Student'}</h2>
                            </div>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <p class="stat-label">લેવલ</p>
                                <span class="stat-badge">${profile.current_level || 'Beginner'}</span>
                            </div>
                            <div class="stat-item">
                                <p class="stat-label">રેન્ક</p>
                                <p class="stat-value">#${profile.current_rank || '-'}</p>
                            </div>
                            <div class="stat-item">
                                <p class="stat-label">તારીખ</p>
                                <p class="stat-date">${testDate}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="chart-card">
                        <h3 class="chart-title">ટેસ્ટનું પરિણામ</h3>
                        <div class="chart-container">
                            <canvas id="performancePie"></canvas>
                        </div>
                    </div>

                    <div style="display: grid; gap: 16px;">
                        <div class="stats-cards">
                            <div class="stats-card">
                                <div class="stats-card-label">કુલ/મેળવેલ ગુણ</div>
                                <div class="stats-card-value">${test.total_marks} / <span style="color: #3b82f6;">${result.obtained_marks}</span></div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">ચોકસાઈ (Accuracy)</div>
                                <div class="stats-card-value" style="color: #22c55e;">${result.accuracy_percentage.toFixed(1)}%</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">સમય/પ્રશ્ન</div>
                                <div class="stats-card-value">${avgTimePerQ} સેકન્ડ</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">એકાગ્રતા રેટિંગ</div>
                                <div class="stats-card-value" style="color: #a855f7;">${result.concentration_rating}/10</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">સરળ (સાચા/કુલ)</div>
                                <div class="stats-card-value">${result.easy_correct || 0}/${result.easy_total || 0}</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">અઘરા (સાચા/કુલ)</div>
                                <div class="stats-card-value" style="color: #ef4444;">${result.hard_correct || 0}/${result.hard_total || 0}</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">ટાર્ગેટ સ્કોર</div>
                                <div class="stats-card-value">${test.target_score || '-'}</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">સુધારો જરૂર (%)</div>
                                <div class="stats-card-value" style="color: #f59e0b;">${result.improvement_percentage?.toFixed(1) || 0}%</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-card-label">બાકી પ્રશ્નો</div>
                                <div class="stats-card-value">${result.unanswered_count || 0}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="section-title">
                    <i class="fas fa-book-open"></i> વિષય અને ચેપ્ટરવાર એનાલિસિસ
                </h3>

                <div class="subjects-grid" id="subjectsGrid"></div>

                <div class="action-plan-card">
                    <div class="action-plan-bg">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <h3 class="action-plan-title">તમારા માટે એક્શન પ્લાન</h3>
                    <div class="action-plan-content" id="actionPlan"></div>
                </div>

                <div class="goal-card">
                    <p class="goal-text">"આગામી ટેસ્ટમાં ${result.accuracy_percentage < 70 ? '70% થી વધુ' : '90% થી વધુ'} સ્કોર મેળવવાનું લક્ષ્ય રાખવું!"</p>
                </div>
            `;

            // Render subjects
            renderSubjects(subjectData);

            // Render action plan
            renderActionPlan(suggestions, result);

            // Render pie chart
            renderPieChart(correctAnswers, wrongAnswers, skipped);
        }

        function renderSubjects(subjectData) {
            const subjectsGrid = document.getElementById('subjectsGrid');
            
            const colors = [
                { header: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)', badge: '#1e40af' },
                { header: 'linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%)', badge: '#4338ca' },
                { header: 'linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%)', badge: '#be185d' },
                { header: 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)', badge: '#15803d' }
            ];

            subjectData.forEach((subject, index) => {
                const proficiency = ((subject.correct / subject.total) * 100).toFixed(0);
                const color = colors[index % colors.length];
                
                let chaptersHTML = '';
                subject.chapters.forEach(chapter => {
                    const percentage = ((chapter.correct / chapter.total) * 100).toFixed(0);
                    let resultClass = 'result-poor';
                    if (percentage >= 90) resultClass = 'result-excellent';
                    else if (percentage >= 70) resultClass = 'result-good';
                    else if (percentage >= 50) resultClass = 'result-average';

                    chaptersHTML += `
                        <tr>
                            <td>${chapter.name}</td>
                            <td style="text-align: center;">${chapter.total}</td>
                            <td style="text-align: center;">${chapter.correct}</td>
                            <td style="text-align: right;" class="${resultClass}">${percentage}%</td>
                        </tr>
                    `;
                });

                subjectsGrid.innerHTML += `
                    <div class="subject-card">
                        <div class="subject-header" style="background: ${color.header};">
                            <h4 class="subject-title">${subject.name}</h4>
                            <span class="proficiency-badge" style="background: ${color.badge};">નિપુણતા: ${proficiency}%</span>
                        </div>
                        <div class="subject-body">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ચેપ્ટર</th>
                                        <th style="text-align: center;">પ્રશ્નો</th>
                                        <th style="text-align: center;">સાચા</th>
                                        <th style="text-align: right;">પરિણામ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${chaptersHTML}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
        }

        function renderActionPlan(suggestions, result) {
            const actionPlan = document.getElementById('actionPlan');
            
            if (!suggestions || suggestions.length === 0) {
                actionPlan.innerHTML = `
                    <div class="action-section">
                        <h4>શાબાશ!</h4>
                        <p style="color: #cbd5e1;">તમારું પર્ફોર્મન્સ સારું છે. આગળ વધતા રહો!</p>
                    </div>
                `;
                return;
            }

            // Group suggestions
            const focusAreas = suggestions.slice(0, 3);
            
            let focusHTML = '<ul class="action-list">';
            focusAreas.forEach(sug => {
                focusHTML += `<li><i class="fas fa-check-circle"></i> ${sug.suggestion_text}</li>`;
            });
            focusHTML += '</ul>';

            let planHTML = '<ul class="action-list">';
            focusAreas.forEach(sug => {
                if (sug.action_plan_text) {
                    planHTML += `<li><i class="fas fa-check-circle"></i> ${sug.action_plan_text}</li>`;
                }
            });
            planHTML += '</ul>';

            actionPlan.innerHTML = `
                <div class="action-section">
                    <h4>વધારે સમય આપો:</h4>
                    ${focusHTML}
                </div>
                <div class="action-section">
                    <h4>વાંચન સૂચન:</h4>
                    ${planHTML}
                </div>
            `;
        }

        function renderPieChart(correct, wrong, skipped) {
            const ctx = document.getElementById('performancePie');
            
            if (pieChart) {
                pieChart.destroy();
            }
            
            pieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['સાચા', 'ખોટા', 'બાકી'],
                    datasets: [{
                        data: [correct, wrong, skipped],
                        backgroundColor: ['#22c55e', '#ef4444', '#e5e7eb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Hind Vadodara',
                                    size: 13
                                },
                                padding: 15
                            }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        }

        function showError(message, showRetry = true) {
            app.innerHTML = `
                <div class="card">
                    <h3 style="color: #dc2626;">⚠️ Error</h3>
                    <p style="margin: 15px 0; color: #64748b;">${message}</p>
                    ${showRetry ? '<button class="nav-btn" onclick="location.reload()" style="width: auto;">ફરી પ્રયાસ કરો</button>' : ''}
                </div>
            `;
        }

        // Start the app
        init();
    </script>
</body>
</html>
