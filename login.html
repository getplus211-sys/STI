<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - KAPiLa Learning</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:sans-serif;
  background:#f3f4f6;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px 20px 120px 20px;
}

.logo-section{
  text-align:center;
  margin:40px 0;
}
.logo-title{
  font-size:32px;
  font-weight:bold;
  background:linear-gradient(135deg,#8b5cf6,#7c3aed);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:8px;
}
.logo-subtitle{
  font-size:16px;
  color:#6b7280;
}

.login-card{
  background:#fff;
  border-radius:16px;
  padding:32px 24px;
  width:100%;
  max-width:500px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.form-title{
  font-size:28px;
  font-weight:bold;
  color:#1f2937;
  margin-bottom:24px;
}

.form-group{
  margin-bottom:20px;
}
.form-label{
  display:block;
  font-size:15px;
  font-weight:600;
  color:#374151;
  margin-bottom:8px;
}
.form-input{
  width:100%;
  padding:14px 16px;
  font-size:15px;
  border:1px solid #e5e7eb;
  border-radius:12px;
  background:#f9fafb;
  color:#1f2937;
  transition:all 0.2s;
}
.form-input:focus{
  outline:none;
  border-color:#8b5cf6;
  background:#fff;
}
.form-input::placeholder{
  color:#9ca3af;
}

.password-wrapper{
  position:relative;
}
.toggle-password{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  font-size:24px;
  cursor:pointer;
  padding:4px;
}

.btn{
  width:100%;
  padding:16px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition:transform 0.2s;
  margin-top:8px;
}
.btn:active{transform:scale(0.98)}
.btn-primary{
  background:linear-gradient(135deg,#8b5cf6,#7c3aed);
  color:#fff;
}

.register-link{
  text-align:center;
  margin-top:20px;
  font-size:15px;
  color:#6b7280;
}
.register-link a{
  color:#8b5cf6;
  font-weight:bold;
  text-decoration:none;
}
.register-link a:hover{
  text-decoration:underline;
}

.error-message{
  background:#fee2e2;
  color:#dc2626;
  padding:12px 16px;
  border-radius:8px;
  font-size:14px;
  margin-bottom:16px;
  display:none;
}
</style>
</head>
<body>

<div class="logo-section">
  <div class="logo-title">KAPiLa Learning</div>
  <div class="logo-subtitle">Digital Learning Platform</div>
</div>

<div class="login-card">
  <h2 class="form-title">Login</h2>
  
  <div id="errorMessage" class="error-message"></div>

  <form id="loginForm">
    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" class="form-input" id="email" placeholder="your@email.com" required>
    </div>

    <div class="form-group">
      <label class="form-label">Password</label>
      <div class="password-wrapper">
        <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
        <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
      </div>
    </div>

    <button type="submit" class="btn btn-primary">LOGIN</button>
  </form>

  <div class="register-link">
    Don't have an account? <a href="register.html">Register</a>
  </div>
</div>

<script>
const SUPABASE_URL = "https://bhmycvrbucmbbrpzeane.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4";
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

// Check if already logged in
async function checkAuth() {
  const { data: { user } } = await sb.auth.getUser();
  if (user) {
    window.location.href = 'index-kapila.html';
  }
}

function togglePassword() {
  const input = document.getElementById('password');
  input.type = input.type === 'password' ? 'text' : 'password';
}

function showError(message) {
  const errorDiv = document.getElementById('errorMessage');
  errorDiv.textContent = message;
  errorDiv.style.display = 'block';
  setTimeout(() => {
    errorDiv.style.display = 'none';
  }, 5000);
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  try {
    const { data, error } = await sb.auth.signInWithPassword({
      email: email,
      password: password
    });

    if (error) {
      // Check if user doesn't exist
      if (error.message.includes('Invalid login credentials') || error.message.includes('Email not confirmed')) {
        showError('‡™§‡™Æ‡´á ‡™®‡™µ‡™æ user ‡™õ‡´ã. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™™‡™π‡´á‡™≤‡™æ register ‡™ï‡™∞‡´ã.');
        setTimeout(() => {
          window.location.href = 'register.html';
        }, 2000);
        return;
      }
      throw error;
    }

    // Login successful
    window.location.href = 'index-kapila.html';
    
  } catch (error) {
    console.error('Login error:', error);
    showError(error.message || 'Login failed. Please check your credentials.');
  }
});

checkAuth();
</script>
</body>
</html>
