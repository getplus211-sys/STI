<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STI Mock Test</title>

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<style>
    :root{
        --primary: #004d99; /* deep blue */
        --accent: #ff6600;
        --success: #00a000;
        --bg: #f4f6fb;
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family: Arial, sans-serif;
        background:var(--bg);
        min-height:100vh;
        display:flex;
        flex-direction:column;
    }

    /* HEADER */
    .header{
        background:var(--primary);
        color:#fff;
        padding:14px 16px;
        display:flex;
        justify-content:space-between;
        align-items:center;
    }
    .brand{ font-size:20px; font-weight:700; }
    .auth-area { display:flex; align-items:center; gap:8px; }

    .btn {
        background:#fff;
        color:var(--primary);
        border-radius:8px;
        padding:8px 12px;
        border:none;
        font-weight:700;
        cursor:pointer;
    }
    .btn-ghost { background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.15); }

    #user-name { color:#ffeb99; font-weight:700; margin-right:8px; }

    /* MAIN */
    .container{
        width:92%;
        max-width:720px;
        margin:18px auto;
        flex:1;
    }
    .card{
        background:#fff;
        padding:18px;
        border-radius:12px;
        box-shadow:0 6px 18px rgba(10,20,40,0.06);
        margin-bottom:16px;
    }
    .card h2{ color:var(--primary); margin-top:0; }

    .buy-btn{
        background:var(--accent);
        color:#fff;
        border:none;
        padding:10px 14px;
        border-radius:8px;
        font-weight:800;
        cursor:pointer;
    }

    /* FOOTER */
    .footer{
        background:var(--primary);
        color:#fff;
        text-align:center;
        padding:16px;
        margin-top:18px;
    }
    .footer a{ color:#fff; text-decoration:none; font-weight:700; }

    /* POPUP (center) */
    .overlay{
        display:none;
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.45);
        z-index:9999;
        justify-content:center;
        align-items:center;
        padding:20px;
    }
    .modal{
        width:100%;
        max-width:380px;
        background:#fff;
        border-radius:12px;
        padding:18px;
        box-shadow:0 12px 40px rgba(2,6,23,0.35);
        position:relative;
    }
    .modal h3{ margin:0 0 12px 0; color:var(--primary); }
    .close-x{
        position:absolute;
        right:12px;
        top:10px;
        border:none;
        background:transparent;
        font-size:18px;
        cursor:pointer;
    }
    .field{
        width:100%;
        margin-top:10px;
    }
    input[type="text"], input[type="email"], input[type="password"]{
        width:100%;
        padding:10px 12px;
        border-radius:8px;
        border:1px solid #d6d9e6;
        outline:none;
        font-size:14px;
    }
    .primary-btn{
        width:100%;
        margin-top:14px;
        padding:10px;
        border-radius:8px;
        border:none;
        background:var(--primary);
        color:#fff;
        font-weight:800;
        cursor:pointer;
    }
    .muted{ font-size:13px; color:#667; margin-top:8px; text-align:center; }

    /* responsive smaller */
    @media(max-width:420px){
        .brand{ font-size:18px; }
        .modal{ padding:14px; }
    }
</style>
</head>
<body>

    <header class="header">
        <div class="brand">STI Mock Test</div>
        <div class="auth-area" id="authArea">
            <button class="btn" id="loginOpenBtn">Login</button>
            <button class="btn" id="signupOpenBtn">Register</button>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2>â­ Demo Test - àª®àª«àª¤</h2>
            <p>àª† àª¡à«‡àª®à«‹ àªŸà«‡àª¸à«àªŸ àª«à«àª°à«€ àª›à«‡. àªªàª¹à«‡àª²à«‡àª¥à«€ àªœ àª¤àª®àª¾àª°àª¾ àª®àª¾àª°à«àª• àª…àª¨à«‡ àª—àª¤àª¿àª¶à«€àª²àª¤àª¾ àª¤àªªàª¾àª¸à«‹.</p>
            <a class="buy-btn" href="demo-test-page.html">Start Demo</a>
        </div>

        <div class="card">
            <h2>PSI / ASI Test Paper</h2>
            <p>àª¨àªµà«àª‚ àª¸àª¿àª²à«‡àª¬àª¸ àª†àª§àª¾àª°àª¿àª¤ àªªà«àª°à«‡àª•à«àªŸàª¿àª¸ àªªà«‡àªªàª° â€” â‚¹99</p>
            <button class="buy-btn">Buy Now â‚¹99</button>
        </div>
    </main>

    <footer class="footer">
        <div>Â© 2025 STI Mock Test</div>
        <div style="margin-top:8px"><a href="https://wa.me/916353511804" target="_blank">WhatsApp</a> &nbsp; | &nbsp; <a href="tel:+916353511804">6353511804</a></div>
    </footer>

    <div id="overlay" class="overlay" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <button class="close-x" id="closeModalBtn">&times;</button>

            <div id="modalInner">
                </div>
        </div>
    </div>

<script>
/*
  Custom Netlify Identity flow using netlify-identity-widget's JS API methods
  BUT we DO NOT call netlifyIdentity.open() anywhere â€” so default UI never appears.
  Instead we use netlifyIdentity.login() and netlifyIdentity.signup() methods directly from our forms.
*/

/* Wait for widget to be available, then init */
if (window.netlifyIdentity) {
    netlifyIdentity.init(); // initializes and restores session if present
} else {
    console.warn("Netlify Identity script not loaded.");
}

/* DOM refs */
const overlay = document.getElementById('overlay');
const modalInner = document.getElementById('modalInner');
const closeModalBtn = document.getElementById('closeModalBtn');
const authArea = document.getElementById('authArea');

// ğŸ’¡ Event listeners for opening modal - We use 'load' listeners now
// These will be reattached in updateAuthUI if user is logged out
function attachAuthListeners(){
    const loginOpenBtn = document.getElementById('loginOpenBtn');
    const signupOpenBtn = document.getElementById('signupOpenBtn');

    // Check if elements exist before attaching listener
    if(loginOpenBtn) loginOpenBtn.addEventListener('click', () => openModal('login'));
    if(signupOpenBtn) signupOpenBtn.addEventListener('click', () => openModal('register'));
}


closeModalBtn.addEventListener('click', closeModal);
overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });

/* open modal with type = 'login' or 'register' */
function openModal(type){
    // Build content
    if (type === 'login'){
        modalInner.innerHTML = `
            <h3 id="modalTitle">Login</h3>
            <div class="field"><input id="loginEmail" type="email" placeholder="Email" /></div>
            <div class="field"><input id="loginPass" type="password" placeholder="Password" /></div>
            <button class="primary-btn" id="doLoginBtn">Login</button>
            <div class="muted">Forgot password? Use password reset from Netlify admin or contact support.</div>
        `;
        // attach handler
        setTimeout(()=> {
            document.getElementById('doLoginBtn').addEventListener('click', doLogin);
        },0);
    } else {
        modalInner.innerHTML = `
            <h3 id="modalTitle">Register</h3>
            <div class="field"><input id="signupName" type="text" placeholder="Full name" /></div>
            <div class="field"><input id="signupEmail" type="email" placeholder="Email" /></div>
            <div class="field"><input id="signupPass" type="password" placeholder="Password (6+ chars)" /></div>
            <button class="primary-btn" id="doSignupBtn">Create Account</button>
            <div class="muted">By creating account you agree to our terms.</div>
        `;
        setTimeout(()=> {
            document.getElementById('doSignupBtn').addEventListener('click', doSignup);
        },0);
    }

    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
}

/* close modal */
function closeModal(){
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
}

/* show a small alert style message (simple) */
function showMsg(msg){
    // simple alert is fine for now
    alert(msg);
}

/* Perform login using netlifyIdentity.login() (no widget UI) */
function doLogin(){
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPass').value;

    if (!email || !password) { showMsg('Email àª…àª¨à«‡ Password àª­àª°à«‹'); return; }

    // netlifyIdentity.login accepts credentials and returns a Promise
    // This will sign in and set currentUser; widget will store token
    netlifyIdentity.login({ email, password, remember: true })
    .then(user => {
        closeModal();
        // UI update will happen via netlifyIdentity.on('login') listener
    })
    .catch(err => {
        // err might be an Error object or response; show message
        const msg = err && err.message ? err.message : JSON.stringify(err);
        showMsg('Login àª¨àª¿àª·à«àª«àª³: ' + msg);
    });
}

/* Perform signup using netlifyIdentity.signup() */
function doSignup(){
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPass').value;

    if (!name || !email || !password) { showMsg('àª¤àª®àª¾àª® àª«à«€àª²à«àª¡ àª­àª°à«‹'); return; }
    if (password.length < 6) { showMsg('Password àª“àª›àª¾àª®àª¾àª‚ àª“àª›àª¾ 6 àª…àª•à«àª·àª° àª¹à«‹àªµà«‹ àªœà«‹àªˆàª'); return; }

    netlifyIdentity.signup({
        email,
        password,
        user_metadata: { full_name: name }
    })
    .then(user => {
        // If immediate login is available, user will be logged in; otherwise they may need to confirm.
        closeModal();
        // UI update will happen via netlifyIdentity.on('login') if logged in immediately
        showMsg('àª¬àª§à«àª‚ àª¥àªˆ àª—àª¯à«àª‚. àªœà«‹ àªœàª°à«‚àª° àª¹à«‹àª¯ àª¤à«‹ Email àª®àª¾àª‚àª¥à«€ confirm àª•àª°à«‹.');
    })
    .catch(err => {
        const msg = err && err.message ? err.message : JSON.stringify(err);
        showMsg('Registration àª¨àª¿àª·à«àª«àª³: ' + msg);
    });
}

/* Logout */
function doLogout(){
    // netlifyIdentity.logout() will trigger 'logout' event
    netlifyIdentity.logout();
}

/* Update header/auth UI */
function updateAuthUI(user){
    if (user && user.email){
        // Show name + logout
        const name = (user.user_metadata && (user.user_metadata.full_name || user.user_metadata.name)) || user.email.split('@')[0];
        authArea.innerHTML = `
            <span id="user-name">${escapeHtml(name)}</span>
            <button class="btn btn-ghost" id="logoutBtn">Logout</button>
        `;
        // Attach Logout listener
        document.getElementById('logoutBtn').addEventListener('click', doLogout);
    } else {
        // Show login/register buttons
        authArea.innerHTML = `
            <button class="btn" id="loginOpenBtn">Login</button>
            <button class="btn" id="signupOpenBtn">Register</button>
        `;
        // Reattach Login/Register event listeners
        attachAuthListeners();
    }
}

/* Util: escape html for name display */
function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
}

/* Hook netlifyIdentity events to keep UI in sync */
if (window.netlifyIdentity) {
    // ğŸ’¡ LOGIN: Fired when a user successfully logs in, OR if a session is restored at init
    netlifyIdentity.on('login', (user) => {
        updateAuthUI(user);
    });
    // ğŸ’¡ LOGOUT: Fired when a user successfully logs out
    netlifyIdentity.on('logout', () => {
        updateAuthUI(null);
    });
    // ğŸ’¡ INIT: Fired when netlifyIdentity.init() is done, good place to check initial status
    netlifyIdentity.on('init', (user) => {
        updateAuthUI(user);
    });

    // We don't need to manually check currentUser() here, as it's handled by 'init' event.
    // Ensure initial listeners are attached for the buttons present on page load (before init completes)
    attachAuthListeners();
} else {
    // Fallback if widget not available
    updateAuthUI(null);
}
</script>

</body>
</html>
