<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KAPiLa Institute - Digital Learning Platform</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#f3f4f6;padding-top:70px;padding-bottom:70px}

/* Sticky Header */
.header{position:fixed;top:0;left:0;right:0;z-index:1000;background:#fff;padding:12px 16px;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center}
.brand{flex:1}
.brand-name{font-size:18px;font-weight:bold;color:#ea580c;line-height:1.2}
.brand-subtitle{font-size:10px;color:#ea580c}
.header-right{display:flex;align-items:center;gap:8px}
.menu-btn{width:40px;height:40px;background:#f3f4f6;border-radius:8px;border:none;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer}
.register-btn{background:#2563eb;color:#fff;padding:8px 16px;border-radius:20px;font-size:11px;font-weight:bold;border:none;cursor:pointer}
.user-name{font-size:12px;font-weight:bold;color:#1f2937}

/* Sticky Footer */
.footer{position:fixed;bottom:0;left:0;right:0;z-index:1000;background:#fff;padding:12px 16px;box-shadow:0 -2px 10px rgba(0,0,0,0.1);display:flex;justify-content:space-around;align-items:center}
.footer-btn{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:24px;color:#6b7280;cursor:pointer;position:relative}
.footer-btn.active{color:#2563eb}
.footer-label{font-size:9px;font-weight:600}
.notification-badge{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;font-size:9px;padding:2px 5px;border-radius:10px;font-weight:bold}

/* Content */
.container{padding:0 16px;max-width:600px;margin:0 auto}

/* Side Menu */
.side-menu{position:fixed;top:0;right:-280px;width:280px;height:100%;background:#fff;z-index:2000;transition:right 0.3s;box-shadow:-2px 0 10px rgba(0,0,0,0.1);overflow-y:auto}
.side-menu.open{right:0}
.menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1999;display:none}
.menu-overlay.show{display:block}
.menu-header{padding:20px;background:linear-gradient(135deg,#2563eb,#4f46e5);color:#fff}
.menu-header h3{font-size:18px;margin-bottom:4px}
.menu-header p{font-size:12px;opacity:0.9}
.menu-items{padding:12px 0}
.menu-item{padding:16px 20px;border-bottom:1px solid #f3f4f6;cursor:pointer;display:flex;align-items:center;gap:12px}
.menu-item:hover{background:#f9fafb}
.menu-icon{font-size:24px;width:40px;text-align:center}

/* Modals */
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:3000;align-items:center;justify-content:center;padding:20px}
.modal.show{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:400px;width:100%;padding:24px;max-height:80vh;overflow-y:auto}
.modal-title{font-size:20px;font-weight:bold;margin-bottom:16px;text-align:center}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:12px;font-weight:600;margin-bottom:6px;color:#374151}
.form-input{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
.btn-primary{width:100%;background:#2563eb;color:#fff;padding:12px;border-radius:8px;font-size:14px;font-weight:bold;border:none;cursor:pointer}
.btn-secondary{width:100%;background:#f3f4f6;color:#1f2937;padding:12px;border-radius:8px;font-size:14px;font-weight:600;border:none;cursor:pointer;margin-top:8px}
.tabs{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:20px}
.tab{flex:1;padding:12px;text-align:center;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px}
.tab.active{color:#2563eb;border-bottom-color:#2563eb}
.tab-content{display:none}
.tab-content.active{display:block}

/* Notification Popup */
.notification-popup{position:fixed;top:70px;right:16px;background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.15);max-width:300px;z-index:2500;padding:16px;display:none}
.notification-popup.show{display:block;animation:slideIn 0.3s}
@keyframes slideIn{from{transform:translateX(320px)}to{transform:translateX(0)}}
.notification-item{padding:12px;border-bottom:1px solid #f3f4f6;cursor:pointer}
.notification-item:last-child{border-bottom:none}
.notification-item:hover{background:#f9fafb}
.notification-title{font-size:13px;font-weight:bold;margin-bottom:4px}
.notification-text{font-size:11px;color:#6b7280}
.no-notifications{text-align:center;color:#9ca3af;font-size:13px;padding:20px}
</style>
</head>
<body>

<!-- Sticky Header -->
<header class="header">
  <div class="brand">
    <div class="brand-name">KAPiLa Institute</div>
    <div class="brand-subtitle">Digital Learning Platform</div>
  </div>
  <div class="header-right">
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
    <button id="registerBtn" class="register-btn" onclick="openAuthModal()">Register</button>
    <span id="userNameDisplay" class="user-name" style="display:none"></span>
  </div>
</header>

<!-- Content Area -->
<div class="container" id="content">
  <div style="text-align:center;padding:40px 20px;color:#6b7280">
    <h3>àª²à«‹àª¡ àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...</h3>
    <p style="font-size:13px;margin-top:8px">àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª°àª¾àª¹ àªœà«àª“</p>
  </div>
</div>

<!-- Sticky Footer -->
<footer class="footer">
  <button class="footer-btn active" onclick="navigate('home')">
    <span>ğŸ </span>
    <span class="footer-label">Home</span>
  </button>
  <button class="footer-btn" onclick="navigate('performance')">
    <span>ğŸ“Š</span>
    <span class="footer-label">Performance</span>
  </button>
  <button class="footer-btn" onclick="navigate('contact')">
    <span>ğŸ“</span>
    <span class="footer-label">Contact</span>
  </button>
  <button class="footer-btn" onclick="toggleNotifications()">
    <span>ğŸ””</span>
    <span class="footer-label">Notifications</span>
    <span id="notificationBadge" class="notification-badge" style="display:none">0</span>
  </button>
</footer>

<!-- Side Menu -->
<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
  <div class="menu-header">
    <h3>Menu</h3>
    <p>KAPiLa Institute</p>
  </div>
  <div class="menu-items">
    <div class="menu-item" onclick="menuNavigate('home')">
      <span class="menu-icon">ğŸ </span>
      <span>Home</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('tests')">
      <span class="menu-icon">ğŸ“</span>
      <span>My Tests</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('performance')">
      <span class="menu-icon">ğŸ“Š</span>
      <span>Performance</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('profile')">
      <span class="menu-icon">ğŸ‘¤</span>
      <span>Profile</span>
    </div>
    <div class="menu-item" onclick="handleLogout()">
      <span class="menu-icon">ğŸšª</span>
      <span>Logout</span>
    </div>
  </div>
</div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
  <div class="modal-content">
    <h2 class="modal-title">Login / Register</h2>
    <div class="tabs">
      <div class="tab active" onclick="switchAuthTab('login')">Login</div>
      <div class="tab" onclick="switchAuthTab('register')">Register</div>
    </div>
    
    <div id="loginTab" class="tab-content active">
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" required>
        </div>
        <button type="submit" class="btn-primary">Login</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
    
    <div id="registerTab" class="tab-content">
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="registerName" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="registerEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="registerPassword" required>
        </div>
        <button type="submit" class="btn-primary">Register</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
  </div>
</div>

<!-- Notification Popup -->
<div class="notification-popup" id="notificationPopup">
  <h3 style="font-size:15px;font-weight:bold;margin-bottom:12px">Notifications</h3>
  <div id="notificationList">
    <div class="no-notifications">àª•à«‹àªˆ notifications àª¨àª¥à«€</div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://bhmycvrbucmbbrpzeane.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4";
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

let currentUser = null;

// Load page on init
async function init() {
  checkAuth();
  loadHomePage();
}

// Check authentication
async function checkAuth() {
  const { data: { user } } = await sb.auth.getUser();
  if (user) {
    currentUser = user;
    document.getElementById('registerBtn').style.display = 'none';
    document.getElementById('userNameDisplay').style.display = 'block';
    
    // Load user profile
    const { data: profile } = await sb.from('profiles').select('full_name').eq('id', user.id).single();
    document.getElementById('userNameDisplay').innerText = profile?.full_name || user.email;
  }
}

// Load home page blocks
async function loadHomePage() {
  try {
    const { data, error } = await sb
      .from('home_page_blocks')
      .select('*')
      .eq('is_active', true)
      .order('display_order', { ascending: true });
    
    if (error) throw error;
    
    let html = '';
    if (data && data.length > 0) {
      data.forEach(block => {
        html += block.block_html;
      });
    } else {
      html = '<div style="text-align:center;padding:40px 20px"><h3>àª•à«‹àªˆ content àª¨àª¥à«€</h3><p style="font-size:13px;margin-top:8px">Admin àª¦à«àªµàª¾àª°àª¾ blocks add àª•àª°àªµàª¾àª¨àª¾ àª›à«‡</p></div>';
    }
    
    document.getElementById('content').innerHTML = html;
  } catch (err) {
    console.error('Error:', err);
    document.getElementById('content').innerHTML = '<div style="text-align:center;padding:40px 20px;color:#ef4444"><h3>Error</h3><p style="font-size:13px;margin-top:8px">' + err.message + '</p></div>';
  }
}

// Toggle side menu
function toggleMenu() {
  const menu = document.getElementById('sideMenu');
  const overlay = document.getElementById('menuOverlay');
  menu.classList.toggle('open');
  overlay.classList.toggle('show');
}

// Menu navigation
function menuNavigate(page) {
  toggleMenu();
  navigate(page);
}

// Footer navigation
function navigate(page) {
  document.querySelectorAll('.footer-btn').forEach(btn => btn.classList.remove('active'));
  event.target.closest('.footer-btn').classList.add('active');
  
  switch(page) {
    case 'home':
      window.location.href = 'index.html';
      break;
    case 'performance':
      window.location.href = 'overall-performance.html';
      break;
    case 'contact':
      alert('Contact: +91 6353511804');
      break;
  }
}

// Auth Modal
function openAuthModal() {
  document.getElementById('authModal').classList.add('show');
}

function closeAuthModal() {
  document.getElementById('authModal').classList.remove('show');
}

function switchAuthTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

// Login
async function handleLogin(e) {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  
  const { error } = await sb.auth.signInWithPassword({ email, password });
  
  if (error) {
    alert('Error: ' + error.message);
  } else {
    closeAuthModal();
    window.location.reload();
  }
}

// Register
async function handleRegister(e) {
  e.preventDefault();
  const name = document.getElementById('registerName').value;
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  
  const { error } = await sb.auth.signUp({ 
    email, 
    password,
    options: {
      data: { full_name: name }
    }
  });
  
  if (error) {
    alert('Error: ' + error.message);
  } else {
    alert('Registration successful! Please check your email.');
    closeAuthModal();
  }
}

// Logout
async function handleLogout() {
  await sb.auth.signOut();
  window.location.reload();
}

// Notifications
function toggleNotifications() {
  const popup = document.getElementById('notificationPopup');
  popup.classList.toggle('show');
  
  // Load notifications (you can add database query here)
  loadNotifications();
}

function loadNotifications() {
  // Example notification
  const list = document.getElementById('notificationList');
  list.innerHTML = `
    <div class="notification-item">
      <div class="notification-title">ğŸ‰ New Test Available</div>
      <div class="notification-text">LRD Mock Test 5 àª¹àªµà«‡ available àª›à«‡</div>
    </div>
    <div class="notification-item">
      <div class="notification-title">ğŸ“Š Performance Updated</div>
      <div class="notification-text">àª¤àª®àª¾àª°àª¾ àª›à«‡àª²à«àª²àª¾ test àª¨à«àª‚ result ready àª›à«‡</div>
    </div>
  `;
  
  // Update badge
  document.getElementById('notificationBadge').style.display = 'block';
  document.getElementById('notificationBadge').innerText = '2';
}

// Initialize
init();
</script>
</body>
</html>
