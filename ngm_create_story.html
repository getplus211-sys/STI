<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>àª¸à«àªŸà«‹àª°à«€ àª¬àª¨àª¾àªµà«‹ - NGM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            background: #000;
            height: 100vh;
            user-select: none;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, rgba(0,0,0,0.4) 0%, transparent 100%);
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 0 16px 12px;
            z-index: 1000;
        }

        .header-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .header-btn:active {
            transform: scale(0.9);
        }

        /* Story Canvas */
        .story-canvas {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        .story-canvas.gradient-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .story-canvas.gradient-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .story-canvas.gradient-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .story-canvas.gradient-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .story-canvas.gradient-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .story-canvas.gradient-6 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .story-canvas.gradient-7 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .story-canvas.gradient-8 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .story-canvas.gradient-9 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .story-canvas.gradient-10 { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%); }

        .story-canvas.solid-1 { background: #667eea; }
        .story-canvas.solid-2 { background: #f093fb; }
        .story-canvas.solid-3 { background: #4facfe; }
        .story-canvas.solid-4 { background: #43e97b; }
        .story-canvas.solid-5 { background: #fa709a; }
        .story-canvas.solid-6 { background: #ff6b6b; }
        .story-canvas.solid-7 { background: #4ecdc4; }
        .story-canvas.solid-8 { background: #95e1d3; }

        .story-canvas.dual-1 { background: linear-gradient(180deg, #ee0979 0%, #ff6a00 100%); }
        .story-canvas.dual-2 { background: linear-gradient(180deg, #f857a6 0%, #ff5858 100%); }
        .story-canvas.dual-3 { background: linear-gradient(180deg, #00c6ff 0%, #0072ff 100%); }
        .story-canvas.dual-4 { background: linear-gradient(180deg, #fddb92 0%, #d1fdff 100%); }
        .story-canvas.dual-5 { background: linear-gradient(180deg, #89f7fe 0%, #66a6ff 100%); }

        .story-canvas.triple-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
        .story-canvas.triple-2 { background: linear-gradient(135deg, #f857a6 0%, #ff5858 50%, #fcb045 100%); }
        .story-canvas.triple-3 { background: linear-gradient(135deg, #30cfd0 0%, #330867 50%, #a8edea 100%); }
        .story-canvas.triple-4 { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 50%, #d299c2 100%); }

        /* Glassmorphic Layouts */
        .story-canvas.glass-1::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 10%;
            right: 10%;
            bottom: 20%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .story-canvas.glass-2::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 5%;
            right: 5%;
            bottom: 15%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .story-canvas.glass-3::before {
            content: '';
            position: absolute;
            top: 25%;
            left: 8%;
            right: 8%;
            bottom: 25%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1.5px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        }

        .story-canvas.glass-4::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 12%;
            right: 12%;
            bottom: 10%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            backdrop-filter: blur(25px);
            border-radius: 35px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        /* Image Preview */
        .story-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 80%;
            object-fit: contain;
            border-radius: 12px;
            display: none;
            z-index: 2;
        }

        .story-image.active {
            display: block;
        }

        /* Text Content */
        .story-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            text-align: center;
            color: white;
            font-size: 32px;
            line-height: 1.4;
            word-wrap: break-word;
            white-space: pre-wrap;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 3;
            outline: none;
            cursor: text;
            padding: 20px;
        }

        .story-text:empty::before {
            content: 'àªŸàª¾àªˆàªª àª•àª°àªµàª¾ àª®àª¾àªŸà«‡ àªŸà«‡àªª àª•àª°à«‹';
            color: rgba(255,255,255,0.5);
            font-size: 28px;
        }

        /* Bottom Tools */
        .bottom-tools {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.6) 0%, transparent 100%);
            padding: 20px 16px 40px;
            z-index: 1000;
        }

        .tools-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .tool-btn:active {
            transform: scale(0.9);
        }

        .tool-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
        }

        .tool-icon.close {
            background: rgba(255,255,255,0.1);
        }

        .tool-icon.close::before {
            content: 'Ã—';
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background: #000;
            border-radius: 50%;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-label {
            font-size: 11px;
            font-weight: 500;
        }

        .expand-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .expand-icon:active {
            transform: scale(0.9) rotate(180deg);
        }

        /* Bottom Actions */
        .bottom-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
        }

        .action-btn {
            background: none;
            border: none;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 20px;
            transition: all 0.2s;
        }

        .action-btn.primary {
            background: white;
            color: #000;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .tab-container {
            display: flex;
            gap: 8px;
        }

        .tab-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: rgba(255,255,255,0.7);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 16px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: white;
            color: #000;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: flex-end;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 70vh;
            overflow-y: auto;
            padding: 20px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        /* Background Selector */
        .bg-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .bg-option {
            aspect-ratio: 9/16;
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bg-option.selected {
            border-color: #0095f6;
            transform: scale(1.05);
        }

        .bg-option:active {
            transform: scale(0.95);
        }

        /* Privacy Selector */
        .privacy-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .privacy-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #f5f5f5;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .privacy-option.selected {
            background: #e3f2fd;
            border: 2px solid #0095f6;
        }

        .privacy-icon {
            width: 44px;
            height: 44px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .privacy-info {
            flex: 1;
        }

        .privacy-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .privacy-desc {
            font-size: 13px;
            color: #666;
        }

        /* Mention Search */
        .mention-search {
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 15px;
            outline: none;
        }

        .search-input:focus {
            border-color: #0095f6;
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-item:active {
            transform: scale(0.98);
            background: #e3f2fd;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-username {
            font-size: 13px;
            color: #666;
        }

        /* Text Formatting Tools */
        .text-tools {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .text-tool {
            min-width: 100px;
            padding: 12px 16px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            transition: all 0.2s;
        }

        .text-tool.selected {
            background: #e3f2fd;
            border-color: #0095f6;
        }

        /* Font Size Slider */
        .font-size-control {
            margin-top: 16px;
            padding: 16px;
            background: #f5f5f5;
            border-radius: 12px;
        }

        .font-size-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
        }

        .font-size-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .font-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0095f6;
            cursor: pointer;
        }

        /* Hidden Input */
        .hidden-input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 16px;
            z-index: 3000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        /* Scrollbar */
        .modal-content::-webkit-scrollbar,
        .user-list::-webkit-scrollbar {
            width: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb,
        .user-list::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 2px;
        }

        /* Mentions Display */
        .mentions-display {
            position: absolute;
            bottom: 140px;
            left: 16px;
            right: 16px;
            z-index: 4;
        }

        .mention-tag {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 4px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .mention-remove {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <button class="header-btn" onclick="closeStory()">Ã—</button>
        <button class="header-btn" onclick="openBackgroundSelector()">ğŸ¨</button>
        <button class="header-btn" onclick="openPrivacySelector()">âš™ï¸</button>
    </div>

    <!-- Story Canvas -->
    <div class="story-canvas gradient-1" id="storyCanvas">
        <img class="story-image" id="storyImage" alt="">
        <div class="story-text" id="storyText" contenteditable="true"></div>
    </div>

    <!-- Mentions Display -->
    <div class="mentions-display" id="mentionsDisplay"></div>

    <!-- Bottom Tools -->
    <div class="bottom-tools">
        <div class="tools-row">
            <button class="tool-btn" onclick="openImagePicker()">
                <div class="tool-icon" id="imageIcon">ğŸ–¼ï¸</div>
                <div class="tool-label">àª¬àª¨àª¾àªµà«‹</div>
            </button>
            <div class="expand-icon" onclick="toggleTools()">Ë…</div>
        </div>

        <div class="tools-expanded" id="toolsExpanded" style="display: none;">
            <div class="tools-row" style="margin-bottom: 12px;">
                <button class="tool-btn" onclick="openTextTools()">
                    <div class="tool-icon">Aa</div>
                    <div class="tool-label">àªŸà«‡àª•à«àª¸à«àªŸ</div>
                </button>
                <button class="tool-btn" onclick="openMentionSelector()">
                    <div class="tool-icon">@</div>
                    <div class="tool-label">àª‰àª²à«àª²à«‡àª–</div>
                </button>
                <button class="tool-btn" onclick="openLinkInput()">
                    <div class="tool-icon">ğŸ”—</div>
                    <div class="tool-label">àª²àª¿àª‚àª•</div>
                </button>
            </div>
        </div>

        <div class="bottom-actions">
            <div class="tab-container">
                <button class="tab-btn">àªªà«‹àª¸à«àªŸ</button>
                <button class="tab-btn active">àª¸à«àªŸà«‹àª°à«€</button>
                <button class="tab-btn">àª°à«€àª²</button>
            </div>
            <button class="action-btn primary" onclick="publishStory()">àª¶à«‡àª° àª•àª°à«‹</button>
        </div>
    </div>

    <!-- Background Selector Modal -->
    <div class="modal-overlay" id="bgModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">àª¬à«‡àª•àª—à«àª°àª¾àª‰àª¨à«àª¡ àªªàª¸àª‚àª¦ àª•àª°à«‹</div>
                <button class="modal-close" onclick="closeBgModal()">Ã—</button>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">àª—à«àª°à«‡àª¡àª¿àª¯àª¨à«àªŸ àª¬à«‡àª•àª—à«àª°àª¾àª‰àª¨à«àª¡</div>
                <div class="bg-grid" id="gradientBgs"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">àª¸à«‹àª²àª¿àª¡ àª°àª‚àª—à«‹</div>
                <div class="bg-grid" id="solidBgs"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">àª¬à«‡ àª°àª‚àª—</div>
                <div class="bg-grid" id="dualBgs"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">àª¤à«àª°àª£ àª°àª‚àª— àª—à«àª°à«‡àª¡àª¿àª¯àª¨à«àªŸ</div>
                <div class="bg-grid" id="tripleBgs"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">àª—à«àª²àª¾àª¸àª®à«‹àª°à«àª«àª¿àª• àª²à«‡àª†àª‰àªŸ</div>
                <div class="bg-grid" id="glassBgs"></div>
            </div>
        </div>
    </div>

    <!-- Privacy Selector Modal -->
    <div class="modal-overlay" id="privacyModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">àª¸à«àªŸà«‹àª°à«€ àªªà«àª°àª¾àªˆàªµàª¸à«€</div>
                <button class="modal-close" onclick="closePrivacyModal()">Ã—</button>
            </div>

            <div class="privacy-options">
                <div class="privacy-option selected" data-privacy="public">
                    <div class="privacy-icon">ğŸŒ</div>
                    <div class="privacy-info">
                        <div class="privacy-title">àª¸àª¾àª°à«àªµàªœàª¨àª¿àª•</div>
                        <div class="privacy-desc">àª¦àª°à«‡àª• àª¤àª®àª¾àª°à«€ àª¸à«àªŸà«‹àª°à«€ àªœà«‹àªˆ àª¶àª•à«‡ àª›à«‡</div>
                    </div>
                </div>

                <div class="privacy-option" data-privacy="followers">
                    <div class="privacy-icon">ğŸ‘¥</div>
                    <div class="privacy-info">
                        <div class="privacy-title">àª«à«‹àª²à«‹àªµàª°à«àª¸ àª®àª¾àªŸà«‡</div>
                        <div class="privacy-desc">àª«àª•à«àª¤ àª¤àª®àª¾àª°àª¾ àª«à«‹àª²à«‹àªµàª°à«àª¸ àªœà«‹àªˆ àª¶àª•à«‡ àª›à«‡</div>
                    </div>
                </div>

                <div class="privacy-option" data-privacy="private">
                    <div class="privacy-icon">ğŸ”’</div>
                    <div class="privacy-info">
                        <div class="privacy-title">àª–àª¾àª¨àª—à«€</div>
                        <div class="privacy-desc">àª«àª•à«àª¤ àª¤àª®à«‡ àª† àª¸à«àªŸà«‹àª°à«€ àªœà«‹àªˆ àª¶àª•à«‹ àª›à«‹</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mention Selector Modal -->
    <div class="modal-overlay" id="mentionModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">àª¯à«àªàª°à«àª¸àª¨à«‹ àª‰àª²à«àª²à«‡àª– àª•àª°à«‹</div>
                <button class="modal-close" onclick="closeMentionModal()">Ã—</button>
            </div>

            <div class="mention-search">
                <input type="text" class="search-input" id="mentionSearch" 
                       placeholder="àª«à«‹àª²à«‹àªµàª°à«àª¸ àª…àª¨à«‡ àª«à«‹àª²à«‹àªˆàª‚àª— àª¶à«‹àª§à«‹..." 
                       oninput="searchUsers(this.value)">
            </div>

            <div class="user-list" id="userList"></div>
        </div>
    </div>

    <!-- Text Tools Modal -->
    <div class="modal-overlay" id="textToolsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">àªŸà«‡àª•à«àª¸à«àªŸ àª«à«‹àª°à«àª®à«‡àªŸàª¿àª‚àª—</div>
                <button class="modal-close" onclick="closeTextToolsModal()">Ã—</button>
            </div>

            <div class="text-tools">
                <div class="text-tool" onclick="setTextAlign('left')">àª¡àª¾àª¬à«€ àª¬àª¾àªœà«</div>
                <div class="text-tool" onclick="setTextAlign('center')">àª®àª§à«àª¯àª®àª¾àª‚</div>
                <div class="text-tool" onclick="setTextAlign('right')">àªœàª®àª£à«€ àª¬àª¾àªœà«</div>
            </div>

            <div class="font-size-control">
                <div class="font-size-label">
                    <span>àª«à«‹àª¨à«àªŸ àª¸àª¾àªˆàª</span>
                    <span id="fontSizeValue">32px</span>
                </div>
                <input type="range" class="font-size-slider" min="16" max="64" value="32" 
                       oninput="setFontSize(this.value)">
            </div>
        </div>
    </div>

    <!-- Link Input Modal -->
    <div class="modal-overlay" id="linkModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">àª²àª¿àª‚àª• àª‰àª®à«‡àª°à«‹</div>
                <button class="modal-close" onclick="closeLinkModal()">Ã—</button>
            </div>

            <div class="mention-search">
                <input type="text" class="search-input" id="linkInput" 
                       placeholder="URL àª¦àª¾àª–àª² àª•àª°à«‹ (àª¦àª¾.àª¤., https://example.com)">
            </div>

            <button class="action-btn primary" style="width: 100%; margin-top: 16px;" 
                    onclick="addLink()">àª²àª¿àª‚àª• àª‰àª®à«‡àª°à«‹</button>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" class="hidden-input" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">

    <!-- Loading -->
    <div class="loading" id="loading">àªªà«àª°àª•àª¾àª¶àª¿àª¤ àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...</div>

    <script>
        // State Management
        let storyData = {
            background: 'gradient-1',
            imageUrl: null,
            imageFile: null,
            text: '',
            mentions: [],
            link: null,
            privacy: 'public',
            fontSize: 32,
            textAlign: 'center'
        };

        // Sample users data (followers and following)
        const sampleUsers = [
            { id: '1', name: 'Raj Patel', username: 'rajpatel', avatar: 'R' },
            { id: '2', name: 'Priya Shah', username: 'priyashah', avatar: 'P' },
            { id: '3', name: 'Amit Kumar', username: 'amitkumar', avatar: 'A' },
            { id: '4', name: 'Neha Desai', username: 'nehadesai', avatar: 'N' },
            { id: '5', name: 'Vikas Mehta', username: 'vikasmehta', avatar: 'V' },
            { id: '6', name: 'Anjali Verma', username: 'anjaliverma', avatar: 'A' },
            { id: '7', name: 'Rohit Singh', username: 'rohitsingh', avatar: 'R' },
            { id: '8', name: 'Kavita Joshi', username: 'kavitajoshi', avatar: 'K' }
        ];

        // Initialize backgrounds
        function initBackgrounds() {
            // Gradient backgrounds
            const gradientContainer = document.getElementById('gradientBgs');
            for (let i = 1; i <= 10; i++) {
                const div = document.createElement('div');
                div.className = `bg-option gradient-${i}`;
                if (i === 1) div.classList.add('selected');
                div.onclick = () => selectBackground(`gradient-${i}`);
                gradientContainer.appendChild(div);
            }

            // Solid backgrounds
            const solidContainer = document.getElementById('solidBgs');
            for (let i = 1; i <= 8; i++) {
                const div = document.createElement('div');
                div.className = `bg-option solid-${i}`;
                div.onclick = () => selectBackground(`solid-${i}`);
                solidContainer.appendChild(div);
            }

            // Dual tone backgrounds
            const dualContainer = document.getElementById('dualBgs');
            for (let i = 1; i <= 5; i++) {
                const div = document.createElement('div');
                div.className = `bg-option dual-${i}`;
                div.onclick = () => selectBackground(`dual-${i}`);
                dualContainer.appendChild(div);
            }

            // Triple gradient backgrounds
            const tripleContainer = document.getElementById('tripleBgs');
            for (let i = 1; i <= 4; i++) {
                const div = document.createElement('div');
                div.className = `bg-option triple-${i}`;
                div.onclick = () => selectBackground(`triple-${i}`);
                tripleContainer.appendChild(div);
            }

            // Glassmorphic backgrounds
            const glassContainer = document.getElementById('glassBgs');
            for (let i = 1; i <= 4; i++) {
                const div = document.createElement('div');
                div.className = `bg-option gradient-${i} glass-${i}`;
                div.onclick = () => selectBackground(`gradient-${i} glass-${i}`);
                glassContainer.appendChild(div);
            }
        }

        // Background selection
        function selectBackground(bgClass) {
            const canvas = document.getElementById('storyCanvas');
            canvas.className = `story-canvas ${bgClass}`;
            storyData.background = bgClass;

            // Update selected state
            document.querySelectorAll('.bg-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // Image handling
        function openImagePicker() {
            document.getElementById('imageInput').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check file size (max 500KB)
            if (file.size > 500 * 1024) {
                alert('àªˆàª®à«‡àªœ àª¸àª¾àªˆàª 500KB àª•àª°àª¤àª¾àª‚ àª“àª›à«àª‚ àª¹à«‹àªµà«àª‚ àªœà«‹àªˆàª');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('storyImage');
                img.src = e.target.result;
                img.classList.add('active');
                storyData.imageUrl = e.target.result;
                storyData.imageFile = file;

                // Update icon
                document.getElementById('imageIcon').innerHTML = 'ğŸ–¼ï¸<div class="tool-icon close"></div>';
            };
            reader.readAsDataURL(file);
        }

        // Text handling
        document.getElementById('storyText').addEventListener('input', function() {
            storyData.text = this.innerText;
            
            // Auto-detect and linkify URLs
            const text = this.innerText;
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = text.match(urlRegex);
            if (matches && matches.length > 0) {
                storyData.link = matches[0];
            }
        });

        // Mention handling
        function openMentionSelector() {
            document.getElementById('mentionModal').classList.add('active');
            loadUsers();
        }

        function closeMentionModal() {
            document.getElementById('mentionModal').classList.remove('active');
        }

        function loadUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            
            sampleUsers.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div class="user-avatar">${user.avatar}</div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-username">@${user.username}</div>
                    </div>
                `;
                userDiv.onclick = () => addMention(user);
                userList.appendChild(userDiv);
            });
        }

        function searchUsers(query) {
            const filtered = sampleUsers.filter(user => 
                user.name.toLowerCase().includes(query.toLowerCase()) ||
                user.username.toLowerCase().includes(query.toLowerCase())
            );
            
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            
            filtered.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div class="user-avatar">${user.avatar}</div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-username">@${user.username}</div>
                    </div>
                `;
                userDiv.onclick = () => addMention(user);
                userList.appendChild(userDiv);
            });
        }

        function addMention(user) {
            if (!storyData.mentions.find(m => m.id === user.id)) {
                storyData.mentions.push(user);
                updateMentionsDisplay();
            }
            closeMentionModal();
        }

        function removeMention(userId) {
            storyData.mentions = storyData.mentions.filter(m => m.id !== userId);
            updateMentionsDisplay();
        }

        function updateMentionsDisplay() {
            const display = document.getElementById('mentionsDisplay');
            display.innerHTML = storyData.mentions.map(user => `
                <span class="mention-tag">
                    @${user.username}
                    <span class="mention-remove" onclick="removeMention('${user.id}')">Ã—</span>
                </span>
            `).join('');
        }

        // Link handling
        function openLinkInput() {
            document.getElementById('linkModal').classList.add('active');
        }

        function closeLinkModal() {
            document.getElementById('linkModal').classList.remove('active');
        }

        function addLink() {
            const link = document.getElementById('linkInput').value;
            if (link && (link.startsWith('http://') || link.startsWith('https://'))) {
                storyData.link = link;
                closeLinkModal();
                alert('àª²àª¿àª‚àª• àª¸àª«àª³àª¤àª¾àªªà«‚àª°à«àªµàª• àª‰àª®à«‡àª°àª¾àªˆ!');
            } else {
                alert('àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ http:// àª…àª¥àªµàª¾ https:// àª¥à«€ àª¶àª°à«‚ àª¥àª¤à«àª‚ àª®àª¾àª¨à«àª¯ URL àª¦àª¾àª–àª² àª•àª°à«‹');
            }
        }

        // Privacy handling
        function openPrivacySelector() {
            document.getElementById('privacyModal').classList.add('active');
        }

        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.remove('active');
        }

        document.querySelectorAll('.privacy-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.privacy-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                storyData.privacy = this.dataset.privacy;
            });
        });

        // Text tools
        function openTextTools() {
            document.getElementById('textToolsModal').classList.add('active');
        }

        function closeTextToolsModal() {
            document.getElementById('textToolsModal').classList.remove('active');
        }

        function setTextAlign(align) {
            document.getElementById('storyText').style.textAlign = align;
            storyData.textAlign = align;
        }

        function setFontSize(size) {
            document.getElementById('storyText').style.fontSize = size + 'px';
            document.getElementById('fontSizeValue').innerText = size + 'px';
            storyData.fontSize = size;
        }

        // Background modal
        function openBackgroundSelector() {
            document.getElementById('bgModal').classList.add('active');
        }

        function closeBgModal() {
            document.getElementById('bgModal').classList.remove('active');
        }

        // Tools toggle
        function toggleTools() {
            const tools = document.getElementById('toolsExpanded');
            const icon = event.target;
            if (tools.style.display === 'none') {
                tools.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                tools.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Publish story
        async function publishStory() {
            // Validate
            if (!storyData.text && !storyData.imageUrl) {
                alert('àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¤àª®àª¾àª°à«€ àª¸à«àªŸà«‹àª°à«€àª®àª¾àª‚ àª•àª‚àªˆàª• àª¸àª¾àª®àª—à«àª°à«€ àª‰àª®à«‡àª°à«‹');
                return;
            }

            document.getElementById('loading').classList.add('active');

            // Simulate API call
            setTimeout(() => {
                console.log('Publishing story:', storyData);
                document.getElementById('loading').classList.remove('active');
                alert('àª¸à«àªŸà«‹àª°à«€ àª¸àª«àª³àª¤àª¾àªªà«‚àª°à«àªµàª• àªªà«àª°àª•àª¾àª¶àª¿àª¤ àª¥àªˆ!');
                
                // Here you would make actual API call to save story
                // const formData = new FormData();
                // formData.append('background', storyData.background);
                // formData.append('text', storyData.text);
                // formData.append('mentions', JSON.stringify(storyData.mentions));
                // formData.append('link', storyData.link);
                // formData.privacy', storyData.privacy);
                // if (storyData.imageFile) {
                //     formData.append('image', storyData.imageFile);
                // }
                // fetch('/api/stories', { method: 'POST', body: formData });
            }, 2000);
        }

        // Close story
        function closeStory() {
            if (confirm('àª† àª¸à«àªŸà«‹àª°à«€ àª°àª¦ àª•àª°àªµà«€ àª›à«‡?')) {
                window.history.back();
            }
        }

        // Initialize
        initBackgrounds();
    </script>
</body>
</html>
