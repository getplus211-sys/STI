<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STI Mock Test</title>

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<style>
    :root{
        --primary: #004d99; /* deep blue */
        --accent: #ff6600;
        --success: #00a000;
        --bg: #f4f6fb;
    }
    *{box-sizing:border-box}
    body{
        margin:0;
        font-family: Arial, sans-serif;
        background:var(--bg);
        min-height:100vh;
        display:flex;
        flex-direction:column;
    }

    /* HEADER */
    .header{
        background:var(--primary);
        color:#fff;
        padding:14px 16px;
        display:flex;
        justify-content:space-between;
        align-items:center;
    }
    .brand{ font-size:20px; font-weight:700; }
    .auth-area { display:flex; align-items:center; gap:8px; }

    .btn {
        background:#fff;
        color:var(--primary);
        border-radius:8px;
        padding:8px 12px;
        border:none;
        font-weight:700;
        cursor:pointer;
    }
    .btn-ghost { background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.15); }

    #user-name { color:#ffeb99; font-weight:700; margin-right:8px; }

    /* MAIN */
    .container{
        width:92%;
        max-width:720px;
        margin:18px auto;
        flex:1;
    }
    .card{
        background:#fff;
        padding:18px;
        border-radius:12px;
        box-shadow:0 6px 18px rgba(10,20,40,0.06);
        margin-bottom:16px;
    }
    .card h2{ color:var(--primary); margin-top:0; }

    .buy-btn{
        background:var(--accent);
        color:#fff;
        border:none;
        padding:10px 14px;
        border-radius:8px;
        font-weight:800;
        cursor:pointer;
    }

    /* FOOTER */
    .footer{
        background:var(--primary);
        color:#fff;
        text-align:center;
        padding:16px;
        margin-top:18px;
    }
    .footer a{ color:#fff; text-decoration:none; font-weight:700; }

    /* POPUP (center) */
    .overlay{
        display:none;
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.45);
        z-index:9999;
        justify-content:center;
        align-items:center;
        padding:20px;
    }
    .modal{
        width:100%;
        max-width:380px;
        background:#fff;
        border-radius:12px;
        padding:18px;
        box-shadow:0 12px 40px rgba(2,6,23,0.35);
        position:relative;
    }
    .modal h3{ margin:0 0 12px 0; color:var(--primary); }
    .close-x{
        position:absolute;
        right:12px;
        top:10px;
        border:none;
        background:transparent;
        font-size:18px;
        cursor:pointer;
    }
    .field{
        width:100%;
        margin-top:10px;
    }
    input[type="text"], input[type="email"], input[type="password"]{
        width:100%;
        padding:10px 12px;
        border-radius:8px;
        border:1px solid #d6d9e6;
        outline:none;
        font-size:14px;
    }
    .primary-btn{
        width:100%;
        margin-top:14px;
        padding:10px;
        border-radius:8px;
        border:none;
        background:var(--primary);
        color:#fff;
        font-weight:800;
        cursor:pointer;
    }
    .muted{ font-size:13px; color:#667; margin-top:8px; text-align:center; }

    /* responsive smaller */
    @media(max-width:420px){
        .brand{ font-size:18px; }
        .modal{ padding:14px; }
    }
</style>
</head>
<body>

    <header class="header">
        <div class="brand">STI Mock Test</div>
        <div class="auth-area" id="authArea">
            <button class="btn" id="loginOpenBtn">Login</button>
            <button class="btn" id="signupOpenBtn">Register</button>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2>â­ Demo Test - àª®àª«àª¤</h2>
            <p>àª† àª¡à«‡àª®à«‹ àªŸà«‡àª¸à«àªŸ àª«à«àª°à«€ àª›à«‡. àªªàª¹à«‡àª²à«‡àª¥à«€ àªœ àª¤àª®àª¾àª°àª¾ àª®àª¾àª°à«àª• àª…àª¨à«‡ àª—àª¤àª¿àª¶à«€àª²àª¤àª¾ àª¤àªªàª¾àª¸à«‹.</p>
            <a class="buy-btn" href="demo-test-page.html">Start Demo</a>
        </div>

        <div class="card">
            <h2>PSI / ASI Test Paper</h2>
            <p>àª¨àªµà«àª‚ àª¸àª¿àª²à«‡àª¬àª¸ àª†àª§àª¾àª°àª¿àª¤ àªªà«àª°à«‡àª•à«àªŸàª¿àª¸ àªªà«‡àªªàª° â€” â‚¹99</p>
            <button class="buy-btn">Buy Now â‚¹99</button>
        </div>
    </main>

    <footer class="footer">
        <div>Â© 2025 STI Mock Test</div>
        <div style="margin-top:8px"><a href="https://wa.me/916353511804" target="_blank">WhatsApp</a> &nbsp; | &nbsp; <a href="tel:+916353511804">6353511804</a></div>
    </footer>

    <div id="overlay" class="overlay" aria-hidden="true">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <button class="close-x" id="closeModalBtn">&times;</button>

            <div id="modalInner">
                </div>
        </div>
    </div>

<script>
/*
  Custom Netlify Identity flow using netlify-identity-widget's JS API methods
  We use netlifyIdentity.login() and netlifyIdentity.signup() methods directly from our forms.
*/

/* Wait for widget to be available, then init */
if (window.netlifyIdentity) {
    netlifyIdentity.init(); // initializes and restores session if present
} else {
    console.warn("Netlify Identity script not loaded.");
}

/* DOM refs */
const overlay = document.getElementById('overlay');
const modalInner = document.getElementById('modalInner');
const closeModalBtn = document.getElementById('closeModalBtn');
const authArea = document.getElementById('authArea');

// ğŸ’¡ àª«àª‚àª•à«àª¶àª¨ àªœà«‡ Login àª…àª¨à«‡ Register àª¬àªŸàª¨ àªªàª° àª²àª¿àª¸à«àªŸàª¨àª° àªœà«‹àª¡à«‡ àª›à«‡
function attachAuthListeners(){
    const loginOpenBtn = document.getElementById('loginOpenBtn');
    const signupOpenBtn = document.getElementById('signupOpenBtn');

    // àª–àª¾àª¤àª°à«€ àª•àª°à«‹ àª•à«‡ àª¬àªŸàª¨ DOM àª®àª¾àª‚ àª¹àª¾àªœàª° àª›à«‡
    if(loginOpenBtn) {
        // àªªàª¹à«‡àª²àª¾àª¥à«€ àªœà«‹àª¡àª¾àª¯à«‡àª²à«àª‚ àª¹à«‹àª¯ àª¤à«‹ àª¦à«‚àª° àª•àª°à«‹ (àª¡à«àªªà«àª²àª¿àª•à«‡àª¶àª¨ àªŸàª¾àª³àªµàª¾ àª®àª¾àªŸà«‡)
        loginOpenBtn.removeEventListener('click', openModalHandler);
        loginOpenBtn.addEventListener('click', openModalHandler);
    }
    if(signupOpenBtn) {
        signupOpenBtn.removeEventListener('click', openModalHandler);
        signupOpenBtn.addEventListener('click', openModalHandler);
    }
}

// ğŸ’¡ Handler function for opening modal
function openModalHandler(e) {
    const type = e.currentTarget.id === 'loginOpenBtn' ? 'login' : 'register';
    openModal(type);
}


// àª®à«‹àª¡àª² àª¬àª‚àª§ àª•àª°àªµàª¾àª¨àª¾ àª¸àª¾àª®àª¾àª¨à«àª¯ àª²àª¿àª¸à«àªŸàª¨àª°
closeModalBtn.addEventListener('click', closeModal);
overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });


/* open modal with type = 'login' or 'register' */
function openModal(type){
    // Build content
    if (type === 'login'){
        modalInner.innerHTML = `
            <h3 id="modalTitle">Login</h3>
            <div class="field"><input id="loginEmail" type="email" placeholder="Email" /></div>
            <div class="field"><input id="loginPass" type="password" placeholder="Password" /></div>
            <button class="primary-btn" id="doLoginBtn">Login</button>
            <div class="muted">Forgot password? Use password reset from Netlify admin or contact support.</div>
        `;
        // attach handler to new button in DOM
        // àª¯à«àªàª°àª¨à«‡àª® àª…àª¨à«‡ àªªàª¾àª¸àªµàª°à«àª¡ àª‡àª¨àªªà«àªŸ àªªàª›à«€ àª²à«‹àª—àª¿àª¨ àª¬àªŸàª¨ àªªàª° àª²àª¿àª¸à«àªŸàª¨àª° àªœà«‹àª¡à«‹
        setTimeout(()=> {
            document.getElementById('doLoginBtn').addEventListener('click', doLogin);
        },0);
    } else {
        modalInner.innerHTML = `
            <h3 id="modalTitle">Register</h3>
            <div class="field"><input id="signupName" type="text" placeholder="Full name" /></div>
            <div class="field"><input id="signupEmail" type="email" placeholder="Email" /></div>
            <div class="field"><input id="signupPass" type="password" placeholder="Password (6+ chars)" /></div>
            <button class="primary-btn" id="doSignupBtn">Create Account</button>
            <div class="muted">By creating account you agree to our terms.</div>
        `;
        // attach handler to new button in DOM
        // àª°àªœà«€àª¸à«àªŸàª° àª¬àªŸàª¨ àªªàª° àª²àª¿àª¸à«àªŸàª¨àª° àªœà«‹àª¡à«‹
        setTimeout(()=> {
            document.getElementById('doSignupBtn').addEventListener('click', doSignup);
        },0);
    }

    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
}

/* close modal */
function closeModal(){
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
}

/* show a small alert style message (simple) */
function showMsg(msg){
    alert(msg);
}

/* Perform login using netlifyIdentity.login() */
function doLogin(){
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPass').value;

    if (!email || !password) { showMsg('Email àª…àª¨à«‡ Password àª­àª°à«‹'); return; }

    netlifyIdentity.login({ email, password, remember: true })
    .then(user => {
        closeModal();
        // UI update will happen via netlifyIdentity.on('login') listener
    })
    .catch(err => {
        const msg = err && err.message ? err.message : JSON.stringify(err);
        showMsg('Login àª¨àª¿àª·à«àª«àª³: ' + msg);
    });
}

/* Perform signup using netlifyIdentity.signup() */
function doSignup(){
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPass').value;

    if (!name || !email || !password) { showMsg('àª¤àª®àª¾àª® àª«à«€àª²à«àª¡ àª­àª°à«‹'); return; }
    if (password.length < 6) { showMsg('Password àª“àª›àª¾àª®àª¾àª‚ àª“àª›àª¾ 6 àª…àª•à«àª·àª° àª¹à«‹àªµà«‹ àªœà«‹àªˆàª'); return; }

    netlifyIdentity.signup({
        email,
        password,
        user_metadata: { full_name: name }
    })
    .then(user => {
        closeModal();
        // UI update will happen via netlifyIdentity.on('login') if logged in immediately
        showMsg('àª¬àª§à«àª‚ àª¥àªˆ àª—àª¯à«àª‚. àªœà«‹ àªœàª°à«‚àª° àª¹à«‹àª¯ àª¤à«‹ Email àª®àª¾àª‚àª¥à«€ confirm àª•àª°à«‹.');
    })
    .catch(err => {
        const msg = err && err.message ? err.message : JSON.stringify(err);
        showMsg('Registration àª¨àª¿àª·à«àª«àª³: ' + msg);
    });
}

/* Logout */
function doLogout(){
    // netlifyIdentity.logout() will trigger 'logout' event
    netlifyIdentity.logout();
}

/* Update header/auth UI */
function updateAuthUI(user){
    if (user && user.email){
        // Show name + logout
        const name = (user.user_metadata && (user.user_metadata.full_name || user.user_metadata.name)) || user.email.split('@')[0];
        authArea.innerHTML = `
            <span id="user-name">${escapeHtml(name)}</span>
            <button class="btn btn-ghost" id="logoutBtn">Logout</button>
        `;
        // Attach Logout listener
        document.getElementById('logoutBtn').addEventListener('click', doLogout);
    } else {
        // Show login/register buttons
        authArea.innerHTML = `
            <button class="btn" id="loginOpenBtn">Login</button>
            <button class="btn" id="signupOpenBtn">Register</button>
        `;
        // Reattach Login/Register event listeners to newly created buttons
        attachAuthListeners();
    }
}

/* Util: escape html for name display */
function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
}

/* Hook netlifyIdentity events to keep UI in sync */
if (window.netlifyIdentity) {
    
    // àªœà«àª¯àª¾àª°à«‡ àª¯à«àªàª° àª²à«‹àª—àª¿àª¨ àª•àª°à«‡ àª…àª¥àªµàª¾ àª¸à«‡àª¶àª¨ àª°àª¿àª¸à«àªŸà«‹àª° àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ UI àª…àªªàª¡à«‡àªŸ àª•àª°à«‹
    netlifyIdentity.on('login', (user) => {
        updateAuthUI(user);
    });
    
    // àªœà«àª¯àª¾àª°à«‡ àª¯à«àªàª° àª²à«‹àª—àª†àª‰àªŸ àª•àª°à«‡ àª¤à«àª¯àª¾àª°à«‡ UI àª…àªªàª¡à«‡àªŸ àª•àª°à«‹
    netlifyIdentity.on('logout', () => {
        updateAuthUI(null);
    });
    
    // àªªà«‡àªœ àª²à«‹àª¡ àª¥àª¯àª¾ àªªàª›à«€ àª¤àª°àª¤ àªœ àªªà«àª°àª¾àª°àª‚àª­àª¿àª• àª¸à«àªŸà«‡àªŸàª¸ àª…àªªàª¡à«‡àªŸ àª•àª°à«‹
    netlifyIdentity.on('init', (user) => {
        updateAuthUI(user);
    });

    // àªªà«àª°àª¥àª® àªµàª–àª¤ àªªà«‡àªœ àª²à«‹àª¡ àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ àª²àª¿àª¸à«àªŸàª¨àª° àªœà«‹àª¡à«‹
    // àª† àª–àª¾àª¤àª°à«€ àª•àª°à«‡ àª›à«‡ àª•à«‡ àªœà«‹ Netlify Identity script àª²à«‹àª¡ àª¨ àª¥àª¾àª¯ àª¤à«‹ àªªàª£ àª¬àªŸàª¨à«‹ àª•àª¾àª® àª•àª°à«‡.
    attachAuthListeners();
} else {
    // Fallback àªœà«‹ widget àª‰àªªàª²àª¬à«àª§ àª¨ àª¹à«‹àª¯
    updateAuthUI(null);
}
</script>

</body>
</html>
