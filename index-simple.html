<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<title>KAPiLa Institute - Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui;background:#f1f5f9;padding:0}
.container{max-width:100%;margin:auto;padding:12px}
.loader{text-align:center;padding:40px 20px;color:#64748b}

/* Mobile First - Default Styles */
/* All blocks will be mobile-friendly by default */
</style>
</head>
<body>
<div class="container" id="app">
  <div class="loader">
    <h2>લોડ થઈ રહ્યું છે...</h2>
    <p>કૃપા કરીને રાહ જુઓ</p>
  </div>
</div>

<script>
const SUPABASE_URL = "https://bhmycvrbucmbbrpzeane.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4";
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

async function loadHomePage() {
  try {
    console.log('Loading home page blocks...');
    
    const { data, error } = await sb
      .from('home_page_blocks')
      .select('*')
      .eq('is_active', true)
      .order('display_order', { ascending: true });
    
    console.log('Response:', { data, error });
    
    if (error) {
      console.error('Supabase error:', error);
      throw new Error(error.message || 'Database error');
    }
    
    if (!data || data.length === 0) {
      document.getElementById('app').innerHTML = `
        <div class="loader">
          <h2>⚠️ કોઈ blocks મળ્યા નથી</h2>
          <p>Table માં data add કરો</p>
        </div>
      `;
      return;
    }
    
    let html = '';
    data.forEach(block => {
      html += block.block_html;
    });
    
    document.getElementById('app').innerHTML = html;
    console.log('Page loaded successfully!');
    
  } catch (err) {
    console.error('Error details:', err);
    document.getElementById('app').innerHTML = `
      <div class="loader">
        <h2>❌ Error</h2>
        <p style="color:#ef4444;font-size:14px;margin-top:10px">${err.message}</p>
        <p style="font-size:12px;margin-top:10px">Console check કરો વધુ details માટે</p>
      </div>
    `;
  }
}

loadHomePage();
</script>
</body>
</html>
