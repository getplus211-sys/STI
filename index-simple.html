<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KAPiLa Institute - Digital Learning Platform</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:linear-gradient(135deg,#f0f9ff,#e0f2fe);min-height:100vh;padding-top:70px;padding-bottom:70px}
.header{position:fixed;top:0;left:0;right:0;z-index:1000;background:linear-gradient(135deg,#0ea5e9,#0284c7);box-shadow:0 4px 15px rgba(14,165,233,0.3);padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.brand{flex:1}
.brand-name{font-size:18px;font-weight:bold;color:#fff;line-height:1.2}
.brand-subtitle{font-size:10px;color:rgba(255,255,255,0.95)}
.header-right{display:flex;align-items:center;gap:8px}
.register-btn{background:#fff;color:#0ea5e9;padding:8px 16px;border-radius:20px;font-size:11px;font-weight:bold;border:none;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
.register-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.menu-btn{width:40px;height:40px;background:rgba(255,255,255,0.2);border-radius:8px;border:none;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;color:#fff}
.menu-btn:hover{background:rgba(255,255,255,0.3)}
.user-name{font-size:12px;font-weight:bold;color:#fff}
.footer{position:fixed;bottom:0;left:0;right:0;z-index:1000;background:linear-gradient(135deg,#0ea5e9,#0284c7);padding:12px 16px;box-shadow:0 -4px 15px rgba(14,165,233,0.3);display:flex;justify-content:space-around;align-items:center}
.footer-btn{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:24px;color:rgba(255,255,255,0.7);cursor:pointer;position:relative;transition:all 0.2s}
.footer-btn:hover{transform:translateY(-2px)}
.footer-btn.active{color:#fff}
.footer-label{font-size:9px;font-weight:600}
.notification-badge{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;font-size:9px;padding:2px 5px;border-radius:10px;font-weight:bold}
.container{padding:0 16px;max-width:600px;margin:0 auto}
.side-menu{position:fixed;top:0;right:-280px;width:280px;height:100%;background:#fff;z-index:2000;transition:right 0.3s;box-shadow:-2px 0 10px rgba(0,0,0,0.1);overflow-y:auto}
.side-menu.open{right:0}
.menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1999;display:none}
.menu-overlay.show{display:block}
.menu-header{padding:20px;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;position:relative}
.menu-header h3{font-size:18px;margin-bottom:4px}
.menu-header p{font-size:12px;opacity:0.9}
.menu-close{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:24px;width:32px;height:32px;border-radius:8px;cursor:pointer}
.menu-items{padding:12px 0}
.menu-item{padding:16px 20px;border-bottom:1px solid #f3f4f6;cursor:pointer;display:flex;align-items:center;gap:12px}
.menu-item:hover{background:#f9fafb}
.menu-icon{font-size:24px;width:40px;text-align:center}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:3000;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
.modal.show{display:flex}
.modal-content{background:#fff;border-radius:16px;max-width:400px;width:100%;padding:24px;max-height:90vh;overflow-y:auto;margin:auto}
.modal-header{display:flex;align-items:center;margin-bottom:20px}
.modal-logo{width:50px;height:50px;background:linear-gradient(135deg,#ea580c,#dc2626);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;margin-right:12px;flex-shrink:0}
.modal-title-wrap{flex:1}
.modal-brand{font-size:18px;font-weight:bold;color:#ea580c}
.modal-subtitle{font-size:11px;color:#6b7280}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:12px;font-weight:600;margin-bottom:6px;color:#374151}
.form-input{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
.form-input:focus{border-color:#0ea5e9;outline:none;box-shadow:0 0 0 3px rgba(14,165,233,0.1)}
.password-wrapper{position:relative}
.password-toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:18px;color:#6b7280}
.password-toggle:hover{color:#374151}
.btn-primary{width:100%;background:#0ea5e9;color:#fff;padding:12px;border-radius:8px;font-size:14px;font-weight:bold;border:none;cursor:pointer}
.btn-primary:hover{background:#0284c7}
.btn-secondary{width:100%;background:#f3f4f6;color:#1f2937;padding:12px;border-radius:8px;font-size:14px;font-weight:600;border:none;cursor:pointer;margin-top:8px}
.btn-link{background:none;border:none;color:#0ea5e9;font-size:12px;cursor:pointer;text-decoration:underline;margin-top:8px;width:100%;text-align:center}
.tabs{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:20px}
.tab{flex:1;padding:12px;text-align:center;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px}
.tab.active{color:#0ea5e9;border-bottom-color:#0ea5e9}
.tab-content{display:none}
.tab-content.active{display:block}
.success-popup{background:#fff;border-radius:16px;padding:30px;text-align:center;max-width:350px}
.success-icon{font-size:60px;margin-bottom:16px}
.success-title{font-size:20px;font-weight:bold;margin-bottom:8px}
.success-text{font-size:14px;color:#6b7280;margin-bottom:20px}
.info-row{background:#f9fafb;padding:12px;border-radius:8px;margin:8px 0;display:flex;align-items:center;gap:12px}
.info-label{font-size:11px;color:#6b7280;margin-bottom:2px}
.info-value{font-size:14px;font-weight:600;color:#1f2937}
.price-strike{text-decoration:line-through;color:#9ca3af;font-size:16px}
.price-offer{color:#22c55e;font-size:24px;font-weight:bold}
.error-text{color:#ef4444;font-size:12px;margin-top:4px;display:none}
.error-text.show{display:block}
.password-hint{font-size:11px;color:#6b7280;margin-top:4px}
select.form-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:30px}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="brand-name">KAPiLa Institute</div>
    <div class="brand-subtitle">Digital Learning Platform</div>
  </div>
  <div class="header-right">
    <button id="registerBtn" class="register-btn" onclick="openAuthModal()">Register</button>
    <span id="userNameDisplay" class="user-name" style="display:none"></span>
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
  </div>
</header>

<div class="container" id="content">
  <div style="text-align:center;padding:40px 20px;color:#6b7280">
    <h3>àª²à«‹àª¡ àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...</h3>
  </div>
</div>

<footer class="footer">
  <button class="footer-btn active" onclick="navigateFooter('home')">
    <span>ğŸ </span>
    <span class="footer-label">Home</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('performance')">
    <span>ğŸ“Š</span>
    <span class="footer-label">Performance</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('account')">
    <span>ğŸ‘¤</span>
    <span class="footer-label">Account</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('contact')">
    <span>ğŸ“</span>
    <span class="footer-label">Contact</span>
  </button>
  <button class="footer-btn" onclick="navigateFooter('notification')">
    <span>ğŸ””</span>
    <span class="footer-label">Notifications</span>
    <span id="notificationBadge" class="notification-badge" style="display:none">0</span>
  </button>
</footer>

<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
<div class="side-menu" id="sideMenu">
  <div class="menu-header">
    <button class="menu-close" onclick="toggleMenu()">Ã—</button>
    <h3>KAPiLa Institute</h3>
    <p>Digital Learning Platform</p>
  </div>
  <div class="menu-items">
    <div class="menu-item" id="registerMenuItem" onclick="menuNavigate('register')">
      <span class="menu-icon">âœï¸</span>
      <span>Register</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('home')">
      <span class="menu-icon">ğŸ </span>
      <span>Home</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('about')">
      <span class="menu-icon">â„¹ï¸</span>
      <span>About Us</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('privacy')">
      <span class="menu-icon">ğŸ”’</span>
      <span>Privacy Policy</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('terms')">
      <span class="menu-icon">ğŸ“„</span>
      <span>Terms & Conditions</span>
    </div>
    <div class="menu-item" onclick="menuNavigate('contact')">
      <span class="menu-icon">ğŸ“</span>
      <span>Contact Us</span>
    </div>
    <div class="menu-item" id="logoutMenuItem" style="display:none" onclick="handleLogout()">
      <span class="menu-icon">ğŸšª</span>
      <span>Logout</span>
    </div>
  </div>
</div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Digital Learning Platform</div>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" onclick="switchAuthTab('login')">Login</div>
      <div class="tab" onclick="switchAuthTab('register')">Register</div>
    </div>
    <div id="loginTab" class="tab-content active">
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" placeholder="example@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="password-wrapper">
            <input type="password" class="form-input" id="loginPassword" placeholder="abc123" required>
            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">ğŸ‘ï¸</button>
          </div>
          <div class="password-hint">Example: abc123</div>
        </div>
        <button type="submit" class="btn-primary">Login</button>
        <button type="button" class="btn-link" onclick="showForgotPassword()">Forgot Password?</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
    <div id="registerTab" class="tab-content">
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="registerName" placeholder="àª¤àª®àª¾àª°à«àª‚ àª¨àª¾àª®" required>
        </div>
        <div class="form-group">
          <label class="form-label">Mobile Number</label>
          <input type="tel" class="form-input" id="registerMobile" pattern="[0-9]{10}" placeholder="10 digit mobile number" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="registerEmail" placeholder="example@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">District (àªœàª¿àª²à«àª²à«‹)</label>
          <select class="form-input" id="registerDistrict" required>
            <option value="">Select District</option>
            <option value="Ahmedabad">Ahmedabad (àª…àª®àª¦àª¾àªµàª¾àª¦)</option>
            <option value="Amreli">Amreli (àª…àª®àª°à«‡àª²à«€)</option>
            <option value="Anand">Anand (àª†àª£àª‚àª¦)</option>
            <option value="Aravalli">Aravalli (àª…àª°àªµàª²à«àª²à«€)</option>
            <option value="Banaskantha">Banaskantha (àª¬àª¨àª¾àª¸àª•àª¾àª‚àª àª¾)</option>
            <option value="Bharuch">Bharuch (àª­àª°à«‚àªš)</option>
            <option value="Bhavnagar">Bhavnagar (àª­àª¾àªµàª¨àª—àª°)</option>
            <option value="Botad">Botad (àª¬à«‹àªŸàª¾àª¦)</option>
            <option value="Chhota Udaipur">Chhota Udaipur (àª›à«‹àªŸàª¾ àª‰àª¦à«‡àªªà«àª°)</option>
            <option value="Dahod">Dahod (àª¦àª¾àª¹à«‹àª¦)</option>
            <option value="Dang">Dang (àª¡àª¾àª‚àª—)</option>
            <option value="Devbhoomi Dwarka">Devbhoomi Dwarka (àª¦à«‡àªµàª­à«‚àª®àª¿ àª¦à«àªµàª¾àª°àª•àª¾)</option>
            <option value="Gandhinagar">Gandhinagar (àª—àª¾àª‚àª§à«€àª¨àª—àª°)</option>
            <option value="Gir Somnath">Gir Somnath (àª—à«€àª° àª¸à«‹àª®àª¨àª¾àª¥)</option>
            <option value="Jamnagar">Jamnagar (àªœàª¾àª®àª¨àª—àª°)</option>
            <option value="Junagadh">Junagadh (àªœà«‚àª¨àª¾àª—àª¢)</option>
            <option value="Kheda">Kheda (àª–à«‡àª¡àª¾)</option>
            <option value="Kutch">Kutch (àª•àªšà«àª›)</option>
            <option value="Mahisagar">Mahisagar (àª®àª¹à«€àª¸àª¾àª—àª°)</option>
            <option value="Mehsana">Mehsana (àª®àª¹à«‡àª¸àª¾àª£àª¾)</option>
            <option value="Morbi">Morbi (àª®à«‹àª°àª¬à«€)</option>
            <option value="Narmada">Narmada (àª¨àª°à«àª®àª¦àª¾)</option>
            <option value="Navsari">Navsari (àª¨àªµàª¸àª¾àª°à«€)</option>
            <option value="Panchmahal">Panchmahal (àªªàª‚àªšàª®àª¹àª¾àª²)</option>
            <option value="Patan">Patan (àªªàª¾àªŸàª£)</option>
            <option value="Porbandar">Porbandar (àªªà«‹àª°àª¬àª‚àª¦àª°)</option>
            <option value="Rajkot">Rajkot (àª°àª¾àªœàª•à«‹àªŸ)</option>
            <option value="Sabarkantha">Sabarkantha (àª¸àª¾àª¬àª°àª•àª¾àª‚àª àª¾)</option>
            <option value="Surat">Surat (àª¸à«àª°àª¤)</option>
            <option value="Surendranagar">Surendranagar (àª¸à«àª°à«‡àª¨à«àª¦à«àª°àª¨àª—àª°)</option>
            <option value="Tapi">Tapi (àª¤àª¾àªªà«€)</option>
            <option value="Vadodara">Vadodara (àªµàª¡à«‹àª¦àª°àª¾)</option>
            <option value="Valsad">Valsad (àªµàª²àª¸àª¾àª¡)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <div class="password-wrapper">
            <input type="password" class="form-input" id="registerPassword" minlength="6" placeholder="abc123" required>
            <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">ğŸ‘ï¸</button>
          </div>
          <div class="password-hint">Minimum 6 characters (Example: abc123)</div>
          <div class="error-text" id="passwordError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Confirm Password</label>
          <div class="password-wrapper">
            <input type="password" class="form-input" id="registerPasswordConfirm" minlength="6" placeholder="abc123" required>
            <button type="button" class="password-toggle" onclick="togglePassword('registerPasswordConfirm')">ğŸ‘ï¸</button>
          </div>
          <div class="error-text" id="confirmPasswordError"></div>
        </div>
        <button type="submit" class="btn-primary">Register</button>
        <button type="button" class="btn-secondary" onclick="closeAuthModal()">Cancel</button>
      </form>
    </div>
  </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal" id="forgotPasswordModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ”‘</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Reset Password</div>
      </div>
    </div>
    <h3 style="font-size:16px;font-weight:bold;margin-bottom:12px;text-align:center">Forgot Password?</h3>
    <p style="font-size:13px;color:#6b7280;margin-bottom:16px;text-align:center">àª¤àª®àª¾àª°àª¾ email address àª¦àª¾àª–àª² àª•àª°à«‹ àª…àª¨à«‡ àª…àª®à«‡ àª¤àª®àª¨à«‡ password reset link àª®à«‹àª•àª²à«€àª¶à«àª‚.</p>
    <form onsubmit="handleForgotPassword(event)">
      <div class="form-group">
        <label class="form-label">Email Address</label>
        <input type="email" class="form-input" id="forgotEmail" placeholder="example@email.com" required>
      </div>
      <button type="submit" class="btn-primary">Send Reset Link</button>
      <button type="button" class="btn-secondary" onclick="closeForgotPassword()">Cancel</button>
    </form>
  </div>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal">
  <div class="success-popup">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Digital Learning Platform</div>
      </div>
    </div>
    <div class="success-icon" id="successIcon">âœ…</div>
    <div class="success-title" id="successTitle">Success!</div>
    <div class="success-text" id="successText">Message</div>
    <button class="btn-primary" onclick="closeSuccessModal()">àª¬àª‚àª§ àª•àª°à«‹</button>
  </div>
</div>

<!-- Contact Modal -->
<div class="modal" id="contactModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Digital Learning Platform</div>
      </div>
    </div>
    <h3 style="font-size:18px;font-weight:bold;margin-bottom:16px;text-align:center">ğŸ“ Contact Us</h3>
    <p style="text-align:center;color:#6b7280;font-size:13px;margin-bottom:20px">+91 6353511804</p>
    <a href="https://wa.me/916353511804?text=Hello%20KAPiLa%20Institute" target="_blank" style="display:block;width:100%;background:#22c55e;color:#fff;padding:14px;border-radius:12px;text-align:center;font-weight:bold;text-decoration:none;margin-bottom:12px;font-size:14px">
      WhatsApp
    </a>
    <a href="tel:+916353511804" style="display:block;width:100%;background:#0ea5e9;color:#fff;padding:14px;border-radius:12px;text-align:center;font-weight:bold;text-decoration:none;font-size:14px">
      Call
    </a>
    <button class="btn-secondary" onclick="closeContactModal()" style="margin-top:12px">àª¬àª‚àª§ àª•àª°à«‹</button>
  </div>
</div>

<!-- About Us Modal -->
<div class="modal" id="aboutModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ“</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Digital Learning Platform</div>
      </div>
    </div>
    <h3 style="font-size:18px;font-weight:bold;margin-bottom:16px;text-align:center">â„¹ï¸ About KAPiLa Institute</h3>
    <div style="color:#374151;font-size:14px;line-height:1.8;text-align:justify">
      <p style="margin-bottom:12px">KAPiLa Institute is a leading educational platform dedicated to helping students prepare for competitive government examinations including GPSC, CCE, PSI, Police, Talati, and other state-level exams.</p>
      <p style="margin-bottom:12px">We provide comprehensive study materials, mock tests, and performance analytics to ensure students achieve their dreams of securing government jobs.</p>
      <p style="margin-bottom:12px">Our expert faculty and innovative digital learning approach make exam preparation accessible, effective, and affordable for every student.</p>
      <p style="margin-bottom:12px">With thousands of successful students, KAPiLa Institute has become a trusted name in competitive exam preparation across Gujarat.</p>
      <p>Join us today and take the first step towards your successful career in government service!</p>
    </div>
    <button class="btn-primary" onclick="closeAboutModal()" style="margin-top:20px">àª¬àª‚àª§ àª•àª°à«‹</button>
  </div>
</div>

<!-- Account Modal -->
<div class="modal" id="accountModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-logo">ğŸ‘¤</div>
      <div class="modal-title-wrap">
        <div class="modal-brand">KAPiLa Institute</div>
        <div class="modal-subtitle">Account Information</div>
      </div>
    </div>
    <h3 style="font-size:18px;font-weight:bold;margin-bottom:16px;text-align:center">àª¤àª®àª¾àª°à«€ Account Details</h3>
    <div id="accountInfo"></div>
    <button class="btn-primary" onclick="closeAccountModal()" style="margin-top:20px">àª¬àª‚àª§ àª•àª°à«‹</button>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://bhmycvrbucmbbrpzeane.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJobXljdnJidWNtYmJycHplYW5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2OTQwOTYsImV4cCI6MjA4MDI3MDA5Nn0.qQ3bw9cADG0P8hbGwx76Oeg54l-9FbRWxc92nZdSPL4';
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
let currentUser = null;

// Password toggle function
function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const btn = field.nextElementSibling;
  if (field.type === 'password') {
    field.type = 'text';
    btn.textContent = 'ğŸ™ˆ';
  } else {
    field.type = 'password';
    btn.textContent = 'ğŸ‘ï¸';
  }
}

// Validate password
function validatePassword(password) {
  if (password.length < 6) {
    return 'Password must be at least 6 characters (Example: abc123)';
  }
  return null;
}

// Handle Register with validation
async function handleRegister(event) {
  event.preventDefault();
  
  const name = document.getElementById('registerName').value.trim();
  const mobile = document.getElementById('registerMobile').value.trim();
  const email = document.getElementById('registerEmail').value.trim();
  const district = document.getElementById('registerDistrict').value;
  const password = document.getElementById('registerPassword').value;
  const confirmPassword = document.getElementById('registerPasswordConfirm').value;
  
  // Reset errors
  document.getElementById('passwordError').classList.remove('show');
  document.getElementById('confirmPasswordError').classList.remove('show');
  document.getElementById('passwordError').textContent = '';
  document.getElementById('confirmPasswordError').textContent = '';
  
  // Validate password length
  const passwordError = validatePassword(password);
  if (passwordError) {
    document.getElementById('passwordError').textContent = passwordError;
    document.getElementById('passwordError').classList.add('show');
    return;
  }
  
  // Check password match
  if (password !== confirmPassword) {
    document.getElementById('confirmPasswordError').textContent = 'Passwords do not match. Please re-enter.';
    document.getElementById('confirmPasswordError').classList.add('show');
    document.getElementById('registerPasswordConfirm').value = '';
    return;
  }
  
  try {
    const { data: authData, error: authError } = await sb.auth.signUp({
      email: email,
      password: password,
      options: {
        data: {
          full_name: name,
          mobile_number: mobile,
          district: district
        }
      }
    });
    
    if (authError) throw authError;
    
    if (authData.user) {
      const { error: profileError } = await sb.from('profiles').insert([{
        id: authData.user.id,
        full_name: name,
        mobile_number: mobile,
        district: district,
        email: email
      }]);
      
      if (profileError) console.error('Profile error:', profileError);
      
      closeAuthModal();
      showSuccess('âœ…', 'Registration Successful!', `Welcome ${name}! Your account has been created successfully.`);
      setTimeout(() => window.location.reload(), 2000);
    }
  } catch (error) {
    console.error('Registration error:', error);
    alert('Registration failed: ' + error.message);
  }
}

async function handleLogin(event) {
  event.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  
  try {
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if (error) throw error;
    
    closeAuthModal();
    showSuccess('âœ…', 'Login Successful!', `Welcome back!`);
    setTimeout(() => window.location.reload(), 1500);
  } catch (error) {
    console.error('Login error:', error);
    alert('Login failed: ' + error.message);
  }
}

async function handleForgotPassword(event) {
  event.preventDefault();
  const email = document.getElementById('forgotEmail').value.trim();
  
  try {
    const { error } = await sb.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.origin + '/reset-password.html'
    });
    if (error) throw error;
    
    closeForgotPassword();
    showSuccess('ğŸ“§', 'Reset Link Sent!', `Password reset link has been sent to ${email}`);
  } catch (error) {
    console.error('Forgot password error:', error);
    alert('Failed to send reset link: ' + error.message);
  }
}

async function handleLogout() {
  try {
    const { error } = await sb.auth.signOut();
    if (error) throw error;
    window.location.reload();
  } catch (error) {
    console.error('Logout error:', error);
    alert('Logout failed: ' + error.message);
  }
}

function openAuthModal() {
  document.getElementById('authModal').classList.add('show');
}

function closeAuthModal() {
  document.getElementById('authModal').classList.remove('show');
}

function switchAuthTab(tab) {
  if (tab === 'login') {
    document.querySelectorAll('.tab')[0].classList.add('active');
    document.querySelectorAll('.tab')[1].classList.remove('active');
    document.getElementById('loginTab').classList.add('active');
    document.getElementById('registerTab').classList.remove('active');
  } else {
    document.querySelectorAll('.tab')[1].classList.add('active');
    document.querySelectorAll('.tab')[0].classList.remove('active');
    document.getElementById('registerTab').classList.add('active');
    document.getElementById('loginTab').classList.remove('active');
  }
}

function showForgotPassword() {
  closeAuthModal();
  document.getElementById('forgotPasswordModal').classList.add('show');
}

function closeForgotPassword() {
  document.getElementById('forgotPasswordModal').classList.remove('show');
}

function showSuccess(icon, title, text) {
  document.getElementById('successIcon').textContent = icon;
  document.getElementById('successTitle').textContent = title;
  document.getElementById('successText').textContent = text;
  document.getElementById('successModal').classList.add('show');
}

function closeSuccessModal() {
  document.getElementById('successModal').classList.remove('show');
}

function toggleMenu() {
  document.getElementById('sideMenu').classList.toggle('open');
  document.getElementById('menuOverlay').classList.toggle('show');
}

function menuNavigate(page) {
  toggleMenu();
  if (page === 'register') openAuthModal();
  else if (page === 'about') document.getElementById('aboutModal').classList.add('show');
  else if (page === 'contact') document.getElementById('contactModal').classList.add('show');
  else if (page === 'home') window.location.reload();
}

function closeContactModal() {
  document.getElementById('contactModal').classList.remove('show');
}

function closeAboutModal() {
  document.getElementById('aboutModal').classList.remove('show');
}

function closeAccountModal() {
  document.getElementById('accountModal').classList.remove('show');
}

function navigateFooter(page) {
  document.querySelectorAll('.footer-btn').forEach(btn => btn.classList.remove('active'));
  event.currentTarget.classList.add('active');
  
  if (page === 'home') window.location.href = 'index-kapila.html';
  else if (page === 'performance') window.location.href = 'overall-performance.html';
  else if (page === 'contact') document.getElementById('contactModal').classList.add('show');
  else if (page === 'account') {
    if (currentUser) document.getElementById('accountModal').classList.add('show');
    else openAuthModal();
  }
}

async function loadHomePage() {
  const { data: subjects, error } = await sb.from('kls_subjects').select('*').order('subject_code');
  
  if (error || !subjects) {
    document.getElementById('content').innerHTML = '<div style="text-align:center;padding:40px 20px;color:#ef4444"><h3>Error loading subjects</h3></div>';
    return;
  }
  
  const subjectColors = {
    'MATHS': '#ef4444',
    'REASONING': '#f97316',
    'CONSTITUTION': '#f59e0b',
    'INDIAN_HISTORY': '#84cc16',
    'GUJARAT_HISTORY': '#22c55e',
    'INDIAN_CULTURE': '#10b981',
    'GUJARAT_CULTURE': '#14b8a6',
    'GUJARATI_GRAMMAR': '#06b6d4',
    'INDIAN_GEOGRAPHY': '#0ea5e9',
    'GUJARAT_GEOGRAPHY': '#3b82f6',
    'INDIAN_ECONOMY': '#6366f1',
    'GENERAL_SCIENCE': '#8b5cf6',
    'ENGLISH_GRAMMAR': '#a855f7',
    'GUJARATI_SAHITYA': '#d946ef',
    'SCIENCE_AND_TECH': '#ec4899',
    'DATA_INTERPRETATION': '#f43f5e',
    'CURRENT_AFFAIRS': '#ef4444'
  };
  
  const subjectUrls = {
    'MATHS': 'maths.html',
    'REASONING': 'reasoning.html',
    'CONSTITUTION': 'constitution.html',
    'INDIAN_HISTORY': 'indian-history.html',
    'GUJARAT_HISTORY': 'gujarat-history.html',
    'INDIAN_CULTURE': 'indian-culture.html',
    'GUJARAT_CULTURE': 'gujarat-culture.html',
    'GUJARATI_GRAMMAR': 'gujarati-grammar.html',
    'INDIAN_GEOGRAPHY': 'indian-geography.html',
    'GUJARAT_GEOGRAPHY': 'gujarat-geography.html',
    'INDIAN_ECONOMY': 'indian-economy.html',
    'GENERAL_SCIENCE': 'general-science.html',
    'ENGLISH_GRAMMAR': 'english-grammar.html',
    'GUJARATI_SAHITYA': 'gujarati-sahitya.html',
    'SCIENCE_AND_TECH': 'science-and-tech.html',
    'DATA_INTERPRETATION': 'data-interpretation.html',
    'CURRENT_AFFAIRS': 'current-affairs.html'
  };
  
  const html = `
    <div style="padding:20px 0">
      <h2 style="font-size:22px;font-weight:bold;margin-bottom:20px;color:#1f2937">ğŸ“š Select Subject</h2>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px">
        ${subjects.map(subject => {
          const color = subjectColors[subject.subject_code] || '#6b7280';
          const url = subjectUrls[subject.subject_code] || '#';
          return `<a href="${url}" style="text-decoration:none;background:linear-gradient(135deg,${color},${color}dd);color:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px ${color}40;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100px;text-align:center;transition:transform 0.2s" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'"><div style="font-size:14px;font-weight:600;line-height:1.3">${subject.name}</div></a>`;
        }).join('')}
      </div>
    </div>
  `;
  
  document.getElementById('content').innerHTML = html;
}

async function init() {
  try {
    const { data: { user } } = await sb.auth.getUser();
    currentUser = user;
    
    if (user) {
      const { data: profile } = await sb.from('profiles').select('*').eq('id', user.id).single();
      if (profile) {
        document.getElementById('userNameDisplay').innerText = profile.full_name.split(' ')[0];
        document.getElementById('userNameDisplay').style.display = 'block';
        document.getElementById('registerBtn').style.display = 'none';
        document.getElementById('registerMenuItem').style.display = 'none';
        document.getElementById('logoutMenuItem').style.display = 'flex';
      }
    }
    
    await loadHomePage();
  } catch (error) {
    console.error('Init error:', error);
  }
}

init();
</script>
</body>
</html>
